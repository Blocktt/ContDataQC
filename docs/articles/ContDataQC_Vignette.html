<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>ContDataQC Vignette • ContDataQC</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js" integrity="sha256-FgpCb/KJQlLNfOu91ta32o/NMZxltwRo8QtmkMRdAu8=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/css/bootstrap.min.css" integrity="sha256-916EbMg70RQy9LHiGkXzG8hSg9EdNy97GazNG/aiY1w=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha256-U5ZEeKfGNOja007MMD3YBI0A3OSZOQbeG6z2f2Y0hu8=" crossorigin="anonymous"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.7.1/css/all.min.css" integrity="sha256-nAmazAk6vS34Xqo0BSrTb+abbtFlgsFK7NKSi6o7Y78=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.7.1/css/v4-shims.min.css" integrity="sha256-6qHlizsOWFskGlwVOKuns+D1nB6ssZrHQrNj1wGplHc=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.4/clipboard.min.js" integrity="sha256-FiZwavyI2V6+EXO1U+xzLG3IKldpiTFf3153ea9zikQ=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.9.4/headroom.min.js" integrity="sha256-DJFC1kqIhelURkuza0AvYal5RxMtpzLjFhsnVIeuk+U=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.9.4/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="ContDataQC Vignette">
<meta property="og:description" content="">
<meta name="twitter:card" content="summary">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">ContDataQC</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">2.0.5.9027</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fas fa fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/ContDataQC_Vignette.html">ContDataQC Vignette</a>
    </li>
    <li>
      <a href="../articles/Vignette_Config.html">ContDataQC, Custom Config Files</a>
    </li>
    <li>
      <a href="../articles/Vignette_Lakes.html">ContDataQC Lake ID String Vignette</a>
    </li>
  </ul>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/leppott/ContDataQC">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1>ContDataQC Vignette</h1>
                        <h4 class="author">Erik W. Leppo</h4>
            
            <h4 class="date">2020-01-27</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/leppott/ContDataQC/blob/master/vignettes/ContDataQC_Vignette.Rmd"><code>vignettes/ContDataQC_Vignette.Rmd</code></a></small>
      <div class="hidden name"><code>ContDataQC_Vignette.Rmd</code></div>

    </div>

    
    
<div id="introduction" class="section level1">
<h1 class="hasAnchor">
<a href="#introduction" class="anchor"></a>Introduction</h1>
<p><code>ContDataQC</code> was created by Tetra Tech, Inc. for USEPA in 2017 to meet the needs of the Regional Monitoring Networks to apply a minimum level of quality control to the continuous monitoring data they were collecting.</p>
<p>It is envisioned that this library can be a living package and will add additional functions and routines in the future.</p>
<p>Many of the examples in this vignette are included in the examples in the corresponding functions. Each function in the <code>ContDataQC</code> library includes example data.</p>
<p>The typical user of this package is envisioned as a user of Hobo or other continuous data loggers. Measured parameters are water temperature, sensor depth, air temperature, water pressure, and air pressure. The typical user will retrieve data from their data logger using Hoboware. Once the data is extracted from the logger and save some minimal cleanup to the column heades is performed before using the ‘ContDataQC’ R library.</p>
<p>There is a configuration file (config.R) that allows for customization.</p>
</div>
<div id="installation" class="section level1">
<h1 class="hasAnchor">
<a href="#installation" class="anchor"></a>Installation</h1>
<p>The R library is saved on GitHub for ease of updating and distribution. Issues can be tracked, fixed, and code made available for download. Current users can update the library using the same code used to install the library (see below). Devtools is required for the installation.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw"><a href="https://rdrr.io/r/utils/install.packages.html">install.packages</a></span>(<span class="st">"devtools"</span>)
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span>(devtools)
<span class="kw">install_github</span>(<span class="st">"leppott/ContDataQC"</span>)</code></pre></div>
<p>To contact the authors directly email <a href="mailto:Erik.Leppo@tetratech.com">Erik.Leppo@tetratech.com</a> or <a href="mailto:Jen.Stamp@tetratech.com">Jen.Stamp@tetratech.com</a>.</p>
<p>Occassionaly R does not import all of the necessary dependant libraries. Below is code to install all of the necessary libraries for using the ContDataQC library.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># install all dependant libraries manually</span>
<span class="co"># libraries to be installed</span>
data.packages =<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(
                  <span class="st">"dataRetrieval"</span>   <span class="co"># loads USGS data into R</span>
                  <span class="st">"zoo"</span>,
                  <span class="st">"knitr"</span>,
                  <span class="st">"survival"</span>,
                  <span class="st">"doBy"</span>,
                  <span class="st">"rmarkdown"</span>
                  )

<span class="co"># install packages via a 'for' loop</span>
<span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="op">:</span><span class="kw"><a href="https://rdrr.io/r/base/length.html">length</a></span>(data.packages)) {
  <span class="co">#install.packages("doBy",dependencies=TRUE)</span>
  <span class="kw"><a href="https://rdrr.io/r/utils/install.packages.html">install.packages</a></span>(data.packages[i])
} <span class="co"># end loop</span>

<span class="kw"><a href="https://rdrr.io/r/base/print.html">print</a></span>(<span class="st">"Task complete.  Check statements above for errors."</span>)</code></pre></div>
<p>An additional dependancy that needs to be installed separately is Pandoc. This package is used to create the Reports. See R code below to install Pandoc. The package ‘installr’ allows for installation in a single step. If this doesn’t work you may need help from your IT department using the web links listed below. For users of RStudio Pandoc installs with RStudio so no extra install is needed.</p>
<p>In version 2.0.1.9048 (2017-11-16) of the <code>ContDataQC</code> package report format was added as a variable. The default is “html”. This can be changed in config.R. If you do not have Pandoc installed the package will still work but the reports in docx format will not be created (will show an error) unless you change the format to “html”.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># Install Pandoc (for docx Reports)</span>
<span class="co"># (if using recent version of RStudio do not have to install separately)</span>
<span class="kw"><a href="https://rdrr.io/r/utils/install.packages.html">install.packages</a></span>(<span class="st">"installr"</span>) <span class="co"># not needed if already have this package.</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">require</a></span>(installr)
<span class="kw">install.pandoc</span>()
<span class="co"># The above won't work if don't have admin rights on your computer.</span>
<span class="co"># Alternative = Download the file below and have your IT dept install for you.</span>
<span class="co"># https://github.com/jgm/pandoc/releases/download/1.16.0.2/pandoc-1.16.0.2-windows.msi</span>
<span class="co"># For help for installing via command window:</span>
<span class="co"># http://www.intowindows.com/how-to-run-msi-file-as-administrator-from-command-prompt-in-windows/</span></code></pre></div>
<p>During the summer of 2017 USGS changed their webservices from http to https. This necessitated a change in the R library <code>dataRetrieval</code>. As of the date of this Vignette the 2.7.2 version of <code>dataRetrieval</code> on CRAN is not the most current and fails when retrieving data inside of <code>ContDataQC</code>. The error statement is “Error in x[[1]] : subscript out of bounds”. If using the GetGageData operation in the ContDataQC() function it is necessary to get the most current version (&gt;=2.7.3) of <code>dataRetrieval</code> (see code below). The <code>ContDataQC</code> library was tweaked on 11 September 2017 (version v2.0.1.9035) to work with the revised version of <code>dataRetrieval</code> (v2.7.3).</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># inter-CRAN release hosted on USGS website</span>
<span class="kw"><a href="https://rdrr.io/r/utils/install.packages.html">install.packages</a></span>(<span class="st">"dataRetrieval"</span>,<span class="dt">repos=</span><span class="st">"https://owi.usgs.gov/R"</span>)
<span class="co"># from GitHub</span>
<span class="co"># install.packages("devtools")</span>
<span class="co"># library(devtools)</span>
<span class="co"># install_github("USGS-R/dataRetrieval")</span></code></pre></div>
</div>
<div id="contents" class="section level1">
<h1 class="hasAnchor">
<a href="#contents" class="anchor"></a>Contents</h1>
<ol style="list-style-type: decimal">
<li><p>Preparing Raw Data</p></li>
<li><p>ContDataQC Operations</p></li>
<li><p>Other Features</p></li>
</ol>
</div>
<div id="preparing-raw-data" class="section level1">
<h1 class="hasAnchor">
<a href="#preparing-raw-data" class="anchor"></a>Preparing Raw Data</h1>
<p>The <code>ContDataQC</code> library makes some assumptions on file names and structure.</p>
<div id="file-names" class="section level2">
<h2 class="hasAnchor">
<a href="#file-names" class="anchor"></a>File Names</h2>
<p>Should be of the format StationID_DataType_StartDate_EndDate.csv. The delimiter between sections of the filename can be changed in config.R but not the order or the file type (csv). Date formats in the files can be set with config.R but the date format in the filename must be in the format YYYYMMDD (no separators).</p>
<p>Data types are Air, Water, Gage, and single letter combinations (i.e., AW, AG, and WG).</p>
</div>
<div id="file-structure" class="section level2">
<h2 class="hasAnchor">
<a href="#file-structure" class="anchor"></a>File Structure</h2>
<p>The first line are the field (column) headers. These can be set in config.R.</p>
</div>
</div>
<div id="the-contdataqc-function" class="section level1">
<h1 class="hasAnchor">
<a href="#the-contdataqc-function" class="anchor"></a>The ContDataQC Function</h1>
<p>The ContDataQC() function is the main focus of this library. It is intended to allow the user to perform multiple functions from a single command with different inputs.</p>
<div id="operations" class="section level2">
<h2 class="hasAnchor">
<a href="#operations" class="anchor"></a>Operations</h2>
<p>The operations of the ContDataQC() function are listed below but will be explained in more detail in their own section. <em>GetGageData </em>QCRaw <em>Aggregate </em>SummaryStats</p>
<p>The library assumes that there are the following folders in the working directory: <em>Data0_Original </em>Data1_RAW <em>Data2_QC </em>Data3_Aggregated *Data4_Stats</p>
<p>The folder “Data0_Original” is for the files exported from Hoboware (or other data logger software). These are the unedited files.</p>
<p>The folder “Data1_RAW” is for the files exported from Hoboware (or other data logger software). This folder contains the files as input for the QC portion of the library. These files may have been modified manually or with the formatHobo function.</p>
<p>The folder “Data2_QC” is for the output of the QCRaw operation of the library and the input for the Aggregate operation.</p>
<p>The folder “Data3_Aggregated” is the output of the Aggregate operation and the input for the Stats operation.</p>
<p>The folder “Data4_Stats” is the output of the SummaryStats operation.</p>
<p>For each operation associated with the ContDataQC() function a report is generated as an MS Word DOCX file.</p>
<p>The code below should be run before using the examples of each operation. The code below sets up the directories and some parameters for use in the later code.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># Parameters</span>
Selection.Operation &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"GetGageData"</span>,<span class="st">"QCRaw"</span>, <span class="st">"Aggregate"</span>, <span class="st">"SummaryStats"</span>)
Selection.Type      &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"Air"</span>,<span class="st">"Water"</span>,<span class="st">"AW"</span>,<span class="st">"Gage"</span>,<span class="st">"AWG"</span>,<span class="st">"AG"</span>,<span class="st">"WG"</span>)
Selection.SUB &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"Data0_Original"</span>, <span class="st">"Data1_RAW"</span>,<span class="st">"Data2_QC"</span>,<span class="st">"Data3_Aggregated"</span>,<span class="st">"Data4_Stats"</span>)
myDir.BASE &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/getwd.html">getwd</a></span>()

<span class="co"># Create data directories</span>
myDir.create &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span>(<span class="st">"./"</span>,Selection.SUB[<span class="dv">1</span>])
  <span class="kw"><a href="https://rdrr.io/r/base/ifelse.html">ifelse</a></span>(<span class="kw"><a href="https://rdrr.io/r/base/files2.html">dir.exists</a></span>(myDir.create)<span class="op">==</span><span class="ot">FALSE</span>,<span class="kw"><a href="https://rdrr.io/r/base/files2.html">dir.create</a></span>(myDir.create),<span class="st">"Directory already exists"</span>)
myDir.create &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span>(<span class="st">"./"</span>,Selection.SUB[<span class="dv">2</span>])
  <span class="kw"><a href="https://rdrr.io/r/base/ifelse.html">ifelse</a></span>(<span class="kw"><a href="https://rdrr.io/r/base/files2.html">dir.exists</a></span>(myDir.create)<span class="op">==</span><span class="ot">FALSE</span>,<span class="kw"><a href="https://rdrr.io/r/base/files2.html">dir.create</a></span>(myDir.create),<span class="st">"Directory already exists"</span>)
myDir.create &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span>(<span class="st">"./"</span>,Selection.SUB[<span class="dv">3</span>])
  <span class="kw"><a href="https://rdrr.io/r/base/ifelse.html">ifelse</a></span>(<span class="kw"><a href="https://rdrr.io/r/base/files2.html">dir.exists</a></span>(myDir.create)<span class="op">==</span><span class="ot">FALSE</span>,<span class="kw"><a href="https://rdrr.io/r/base/files2.html">dir.create</a></span>(myDir.create),<span class="st">"Directory already exists"</span>)
myDir.create &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span>(<span class="st">"./"</span>,Selection.SUB[<span class="dv">4</span>])
  <span class="kw"><a href="https://rdrr.io/r/base/ifelse.html">ifelse</a></span>(<span class="kw"><a href="https://rdrr.io/r/base/files2.html">dir.exists</a></span>(myDir.create)<span class="op">==</span><span class="ot">FALSE</span>,<span class="kw"><a href="https://rdrr.io/r/base/files2.html">dir.create</a></span>(myDir.create),<span class="st">"Directory already exists"</span>)
myDir.create &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span>(<span class="st">"./"</span>,Selection.SUB[<span class="dv">5</span>])
  <span class="kw"><a href="https://rdrr.io/r/base/ifelse.html">ifelse</a></span>(<span class="kw"><a href="https://rdrr.io/r/base/files2.html">dir.exists</a></span>(myDir.create)<span class="op">==</span><span class="ot">FALSE</span>,<span class="kw"><a href="https://rdrr.io/r/base/files2.html">dir.create</a></span>(myDir.create),<span class="st">"Directory already exists"</span>)

<span class="co"># Save example data (assumes directory ./Data1_RAW/ exists)</span>
myData &lt;-<span class="st"> </span>data_raw_test2_AW_20130426_<span class="dv">20130725</span>
  <span class="kw"><a href="https://rdrr.io/r/utils/write.table.html">write.csv</a></span>(myData,<span class="kw"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span>(<span class="st">"./"</span>,Selection.SUB[<span class="dv">2</span>],<span class="st">"/test2_AW_20130426_20130725.csv"</span>))
myData &lt;-<span class="st"> </span>data_raw_test2_AW_20130725_<span class="dv">20131015</span>
  <span class="kw"><a href="https://rdrr.io/r/utils/write.table.html">write.csv</a></span>(myData,<span class="kw"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span>(<span class="st">"./"</span>,Selection.SUB[<span class="dv">2</span>],<span class="st">"/test2_AW_20130725_20131015.csv"</span>))
myData &lt;-<span class="st"> </span>data_raw_test2_AW_20140901_<span class="dv">20140930</span>
  <span class="kw"><a href="https://rdrr.io/r/utils/write.table.html">write.csv</a></span>(myData,<span class="kw"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span>(<span class="st">"./"</span>,Selection.SUB[<span class="dv">2</span>],<span class="st">"/test2_AW_20140901_20140930.csv"</span>))
myData &lt;-<span class="st"> </span>data_raw_test4_AW_20160418_<span class="dv">20160726</span>
  <span class="kw"><a href="https://rdrr.io/r/utils/write.table.html">write.csv</a></span>(myData,<span class="kw"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span>(<span class="st">"./"</span>,Selection.SUB[<span class="dv">2</span>],<span class="st">"/test4_AW_20160418_20160726.csv"</span>))
myFile &lt;-<span class="st"> "config.TZ.Central.R"</span>
  <span class="kw"><a href="https://rdrr.io/r/base/files.html">file.copy</a></span>(<span class="kw"><a href="https://rdrr.io/r/base/file.path.html">file.path</a></span>(<span class="kw"><a href="https://rdrr.io/r/base/find.package.html">path.package</a></span>(<span class="st">"ContDataQC"</span>),<span class="st">"extdata"</span>,myFile)
            ,<span class="kw"><a href="https://rdrr.io/r/base/file.path.html">file.path</a></span>(<span class="kw"><a href="https://rdrr.io/r/base/getwd.html">getwd</a></span>(),Selection.SUB[<span class="dv">2</span>],myFile))</code></pre></div>
<div id="getgagedata" class="section level3">
<h3 class="hasAnchor">
<a href="#getgagedata" class="anchor"></a>GetGageData</h3>
<p>The GetGageData operation of the ContDataQC() function retrieves USGS gage data based on user input. Example code and console output is below.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span>(ContDataQC)
<span class="co"># Parameters</span>
Selection.Operation &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"GetGageData"</span>,<span class="st">"QCRaw"</span>, <span class="st">"Aggregate"</span>, <span class="st">"SummaryStats"</span>)
Selection.Type      &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"Air"</span>,<span class="st">"Water"</span>,<span class="st">"AW"</span>,<span class="st">"Gage"</span>,<span class="st">"AWG"</span>,<span class="st">"AG"</span>,<span class="st">"WG"</span>)
Selection.SUB &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"Data0_Original"</span>,<span class="st">"Data1_RAW"</span>,<span class="st">"Data2_QC"</span>,<span class="st">"Data3_Aggregated"</span>,<span class="st">"Data4_Stats"</span>)
myDir.BASE &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/getwd.html">getwd</a></span>()
<span class="co"># Get Gage Data</span>
myData.Operation    &lt;-<span class="st"> "GetGageData"</span> <span class="co">#Selection.Operation[1]</span>
myData.SiteID       &lt;-<span class="st"> "01187300"</span> <span class="co"># Hubbard River near West Hartland, CT</span>
myData.Type         &lt;-<span class="st"> "Gage"</span> <span class="co">#Selection.Type[4] </span>
myData.DateRange.Start  &lt;-<span class="st"> "2013-01-01"</span>
myData.DateRange.End    &lt;-<span class="st"> "2014-12-31"</span>
myDir.import &lt;-<span class="st"> ""</span>
myDir.export &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/file.path.html">file.path</a></span>(myDir.BASE,Selection.SUB[<span class="dv">2</span>])
<span class="kw"><a href="../reference/ContDataQC.html">ContDataQC</a></span>(myData.Operation, myData.SiteID, myData.Type, myData.DateRange.Start
           , myData.DateRange.End, myDir.import, myDir.export)</code></pre></div>
<pre><code>## [1] "Total items to process = 1"
## 
## [1] "Getting available data; 01187300."
## 
##     agency_cd  site_no                           station_nm site_tp_cd
## 530      USGS 01187300 HUBBARD RIVER NEAR WEST HARTLAND, CT         ST
## 531      USGS 01187300 HUBBARD RIVER NEAR WEST HARTLAND, CT         ST
## 532      USGS 01187300 HUBBARD RIVER NEAR WEST HARTLAND, CT         ST
##     dec_lat_va dec_long_va coord_acy_cd dec_coord_datum_cd  alt_va alt_acy_va
## 530    42.0375   -72.93933            H              NAD83  594.57       0.01
## 531    42.0375   -72.93933            H              NAD83  594.57       0.01
## 532    42.0375   -72.93933            H              NAD83  594.57       0.01
##     alt_datum_cd   huc_cd data_type_cd parm_cd stat_cd ts_id loc_web_ds
## 530       NGVD29 01080207           uv   00010    &lt;NA&gt; 66869         NA
## 531       NGVD29 01080207           uv   00060    &lt;NA&gt; 66866         NA
## 532       NGVD29 01080207           uv   00065    &lt;NA&gt; 66867         NA
##     medium_grp_cd parm_grp_cd   srs_id access_cd begin_date   end_date count_nu
## 530           wat        &lt;NA&gt;  1645597         0 2015-11-04 2020-01-27     1545
## 531           wat        &lt;NA&gt;  1645423         0 1990-10-01 2020-01-27    10710
## 532           wat        &lt;NA&gt; 17164583         0 2007-10-01 2020-01-27     4501
## 
## 
## [1] "Processing item 1 of 1, COMPLETE, 01187300."
## 
## [1] "Task COMPLETE; 0.42 min."</code></pre>
<p>Example of getting gage data in a different time zone specified in user modified configuration file.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># Parameters</span>
Selection.Operation &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"GetGageData"</span>,<span class="st">"QCRaw"</span>, <span class="st">"Aggregate"</span>, <span class="st">"SummaryStats"</span>)
Selection.Type      &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"Air"</span>,<span class="st">"Water"</span>,<span class="st">"AW"</span>,<span class="st">"Gage"</span>,<span class="st">"AWG"</span>,<span class="st">"AG"</span>,<span class="st">"WG"</span>)
Selection.SUB &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"Data0_Original"</span>,<span class="st">"Data1_RAW"</span>,<span class="st">"Data2_QC"</span>,<span class="st">"Data3_Aggregated"</span>,<span class="st">"Data4_Stats"</span>)
myDir.BASE &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/getwd.html">getwd</a></span>()
<span class="co"># Get Gage Data (central time zone)</span>
myData.Operation    &lt;-<span class="st"> "GetGageData"</span> <span class="co">#Selection.Operation[1]</span>
myData.SiteID       &lt;-<span class="st"> "07032000"</span> <span class="co"># Mississippi River at Memphis, TN</span>
myData.Type         &lt;-<span class="st"> </span>Selection.Type[<span class="dv">4</span>] <span class="co">#"Gage"</span>
myData.DateRange.Start  &lt;-<span class="st"> "2013-01-01"</span>
myData.DateRange.End    &lt;-<span class="st"> "2014-12-31"</span>
myDir.import &lt;-<span class="st"> ""</span>
myDir.export &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/file.path.html">file.path</a></span>(myDir.BASE,Selection.SUB[<span class="dv">2</span>])
myConfig            &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/file.path.html">file.path</a></span>(<span class="kw"><a href="https://rdrr.io/r/base/getwd.html">getwd</a></span>(),Selection.SUB[<span class="dv">2</span>],<span class="st">"config.TZ.central.R"</span>) <span class="co"># include path if not in working directory</span>
<span class="kw"><a href="../reference/ContDataQC.html">ContDataQC</a></span>(myData.Operation, myData.SiteID, myData.Type, myData.DateRange.Start, myData.DateRange.End, myDir.import, myDir.export, myConfig)</code></pre></div>
</div>
<div id="qcraw" class="section level3">
<h3 class="hasAnchor">
<a href="#qcraw" class="anchor"></a>QCRaw</h3>
<p>This is operation is the main focus of the <code>ContDataQC</code> library. The raw continuous data files are examined for multiple QC tests and the results saved in a new data file (CSV) and a summary report (DOCX file) are generated.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># Parameters</span>
Selection.Operation &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"GetGageData"</span>,<span class="st">"QCRaw"</span>, <span class="st">"Aggregate"</span>, <span class="st">"SummaryStats"</span>)
Selection.Type      &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"Air"</span>,<span class="st">"Water"</span>,<span class="st">"AW"</span>,<span class="st">"Gage"</span>,<span class="st">"AWG"</span>,<span class="st">"AG"</span>,<span class="st">"WG"</span>)
Selection.SUB &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"Data0_Original"</span>,<span class="st">"Data1_RAW"</span>,<span class="st">"Data2_QC"</span>,<span class="st">"Data3_Aggregated"</span>,<span class="st">"Data4_Stats"</span>)
myDir.BASE &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/getwd.html">getwd</a></span>()
<span class="co"># QC Raw Data</span>
myData.Operation &lt;-<span class="st"> "QCRaw"</span> <span class="co">#Selection.Operation[2]</span>
myData.SiteID    &lt;-<span class="st"> "test2"</span>
myData.Type      &lt;-<span class="st"> </span>Selection.Type[<span class="dv">3</span>] <span class="co">#"AW"</span>
myData.DateRange.Start  &lt;-<span class="st"> "2013-01-01"</span>
myData.DateRange.End    &lt;-<span class="st"> "2014-12-31"</span>
myDir.import &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/file.path.html">file.path</a></span>(myDir.BASE,Selection.SUB[<span class="dv">2</span>]) <span class="co">#"Data1_RAW"</span>
myDir.export &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/file.path.html">file.path</a></span>(myDir.BASE,Selection.SUB[<span class="dv">3</span>]) <span class="co">#"Data2_QC"</span>
myReport.format &lt;-<span class="st"> "docx"</span>
<span class="kw"><a href="../reference/ContDataQC.html">ContDataQC</a></span>(myData.Operation, myData.SiteID, myData.Type, myData.DateRange.Start
           , myData.DateRange.End, myDir.import, myDir.export, myReport.format)</code></pre></div>
<p>In some cases two sensors are used (one for air and one for water) and the timing of the sampling is off between the two. The library handles this fine. Example data below. For this example the report output was changed to “html”.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># Parameters</span>
Selection.Operation &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"GetGageData"</span>,<span class="st">"QCRaw"</span>, <span class="st">"Aggregate"</span>, <span class="st">"SummaryStats"</span>)
Selection.Type      &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"Air"</span>,<span class="st">"Water"</span>,<span class="st">"AW"</span>,<span class="st">"Gage"</span>,<span class="st">"AWG"</span>,<span class="st">"AG"</span>,<span class="st">"WG"</span>)
Selection.SUB &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"Data0_Original"</span>,<span class="st">"Data1_RAW"</span>,<span class="st">"Data2_QC"</span>,<span class="st">"Data3_Aggregated"</span>,<span class="st">"Data4_Stats"</span>)
myDir.BASE &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/getwd.html">getwd</a></span>()
<span class="co"># QC Raw Data (offset collection times for air and water sensors)</span>
myData.Operation &lt;-<span class="st"> "QCRaw"</span> <span class="co">#Selection.Operation[2]</span>
myData.SiteID    &lt;-<span class="st"> "test4"</span>
myData.Type      &lt;-<span class="st"> </span>Selection.Type[<span class="dv">3</span>] <span class="co">#"AW"</span>
myData.DateRange.Start  &lt;-<span class="st"> "2016-04-28"</span>
myData.DateRange.End    &lt;-<span class="st"> "2016-07-26"</span>
myDir.import &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/file.path.html">file.path</a></span>(myDir.BASE,Selection.SUB[<span class="dv">2</span>]) <span class="co">#"Data1_RAW"</span>
myDir.export &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/file.path.html">file.path</a></span>(myDir.BASE,Selection.SUB[<span class="dv">3</span>]) <span class="co">#"Data2_QC"</span>
myReport.format &lt;-<span class="st"> "html"</span>
<span class="kw"><a href="../reference/ContDataQC.html">ContDataQC</a></span>(myData.Operation, myData.SiteID, myData.Type, myData.DateRange.Start
           , myData.DateRange.End, myDir.import, myDir.export, myReport.format)</code></pre></div>
</div>
<div id="aggregate" class="section level3">
<h3 class="hasAnchor">
<a href="#aggregate" class="anchor"></a>Aggregate</h3>
<p>After QC the files are ready for analysis. The Aggregate operation allows the user to combine (or split) files across time periods. No report format was specified so the default “docx” format will be generated.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># Parameters</span>
Selection.Operation &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"GetGageData"</span>,<span class="st">"QCRaw"</span>, <span class="st">"Aggregate"</span>, <span class="st">"SummaryStats"</span>)
Selection.Type      &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"Air"</span>,<span class="st">"Water"</span>,<span class="st">"AW"</span>,<span class="st">"Gage"</span>,<span class="st">"AWG"</span>,<span class="st">"AG"</span>,<span class="st">"WG"</span>)
Selection.SUB &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"Data0_Original"</span>,<span class="st">"Data1_RAW"</span>,<span class="st">"Data2_QC"</span>,<span class="st">"Data3_Aggregated"</span>,<span class="st">"Data4_Stats"</span>)
myDir.BASE &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/getwd.html">getwd</a></span>()
<span class="co"># Aggregate Data</span>
myData.Operation &lt;-<span class="st"> "Aggregate"</span> <span class="co">#Selection.Operation[3]</span>
myData.SiteID    &lt;-<span class="st"> "test2"</span>
myData.Type      &lt;-<span class="st"> </span>Selection.Type[<span class="dv">3</span>] <span class="co">#"AW"</span>
myData.DateRange.Start  &lt;-<span class="st"> "2013-01-01"</span>
myData.DateRange.End    &lt;-<span class="st"> "2014-12-31"</span>
myDir.import &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/file.path.html">file.path</a></span>(myDir.BASE,Selection.SUB[<span class="dv">3</span>]) <span class="co">#"Data2_QC"</span>
myDir.export &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/file.path.html">file.path</a></span>(myDir.BASE,Selection.SUB[<span class="dv">4</span>]) <span class="co">#"Data3_Aggregated"</span>
<span class="co">#Leave off myReport.format and get default (docx).</span>
<span class="kw"><a href="../reference/ContDataQC.html">ContDataQC</a></span>(myData.Operation, myData.SiteID, myData.Type, myData.DateRange.Start
           , myData.DateRange.End, myDir.import, myDir.export)</code></pre></div>
</div>
<div id="summarystats" class="section level3">
<h3 class="hasAnchor">
<a href="#summarystats" class="anchor"></a>SummaryStats</h3>
<p>The SummaryStats operation calculates a number of statistics on the data for each sampling day. No report format was specified so the default “docx” format will be generated.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># Parameters</span>
Selection.Operation &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"GetGageData"</span>,<span class="st">"QCRaw"</span>, <span class="st">"Aggregate"</span>, <span class="st">"SummaryStats"</span>)
Selection.Type      &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"Air"</span>,<span class="st">"Water"</span>,<span class="st">"AW"</span>,<span class="st">"Gage"</span>,<span class="st">"AWG"</span>,<span class="st">"AG"</span>,<span class="st">"WG"</span>)
Selection.SUB &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"Data0_Original"</span>,<span class="st">"Data1_RAW"</span>,<span class="st">"Data2_QC"</span>,<span class="st">"Data3_Aggregated"</span>,<span class="st">"Data4_Stats"</span>)
myDir.BASE &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/getwd.html">getwd</a></span>()
<span class="co"># Summary Stats</span>
myData.Operation &lt;-<span class="st"> "SummaryStats"</span> <span class="co">#Selection.Operation[4]</span>
myData.SiteID    &lt;-<span class="st"> "test2"</span>
myData.Type      &lt;-<span class="st"> </span>Selection.Type[<span class="dv">3</span>] <span class="co">#"AW"</span>
myData.DateRange.Start  &lt;-<span class="st"> "2013-01-01"</span>
myData.DateRange.End    &lt;-<span class="st"> "2014-12-31"</span>
myDir.import &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/file.path.html">file.path</a></span>(myDir.BASE,Selection.SUB[<span class="dv">4</span>]) <span class="co">#"Data3_Aggregated"</span>
myDir.export &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/file.path.html">file.path</a></span>(myDir.BASE,Selection.SUB[<span class="dv">5</span>]) <span class="co">#"Data4_Stats"</span>
<span class="co">#Leave off myReport.format and get default (docx).</span>
<span class="kw"><a href="../reference/ContDataQC.html">ContDataQC</a></span>(myData.Operation, myData.SiteID, myData.Type, myData.DateRange.Start
           , myData.DateRange.End, myDir.import, myDir.export)</code></pre></div>
</div>
</div>
<div id="single-file-versions-of-contdataqc-operatations" class="section level2">
<h2 class="hasAnchor">
<a href="#single-file-versions-of-contdataqc-operatations" class="anchor"></a>Single File Versions of ContDataQC Operatations</h2>
<p>The base version of the ContDataQC() function searches the specified directories for files that match the data type and date range. This set up does not work for everyone. Included in the <code>ContDataQC</code> package are “file” versions of the same QCRaw, Aggregate, and SummaryStat functions. These work on a vector of file names (so multiple files can be processed this way).Different report options are used in each example in the code below.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co">#~~~~~~~~~~~~~~</span>
<span class="co"># File Versions</span>
<span class="co">#~~~~~~~~~~~~~~</span>

<span class="co"># QC Data</span>
myData.Operation &lt;-<span class="st"> "QCRaw"</span> <span class="co">#Selection.Operation[2]</span>
<span class="co">#myFile &lt;- "test2_AW_20130426_20130725.csv"</span>
myFile &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"test2_AW_20130426_20130725.csv"</span>, <span class="st">"test2_AW_20130725_20131015.csv"</span>, <span class="st">"test2_AW_20140901_20140930.csv"</span>)
myDir.import &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/file.path.html">file.path</a></span>(<span class="st">"."</span>,<span class="st">"Data1_RAW"</span>)
myDir.export &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/file.path.html">file.path</a></span>(<span class="st">"."</span>,<span class="st">"Data2_QC"</span>)
myReport.format &lt;-<span class="st"> "docx"</span>
<span class="kw"><a href="../reference/ContDataQC.html">ContDataQC</a></span>(myData.Operation, <span class="dt">fun.myDir.import=</span>myDir.import, <span class="dt">fun.myDir.export=</span>myDir.export, <span class="dt">fun.myFile=</span>myFile, myReport.format)

<span class="co"># Aggregate Data</span>
myData.Operation &lt;-<span class="st"> "Aggregate"</span> <span class="co">#Selection.Operation[3]</span>
myFile &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"QC_test2_AW_20130426_20130725.csv"</span>, <span class="st">"QC_test2_AW_20130725_20131015.csv"</span>, <span class="st">"QC_test2_AW_20140901_20140930.csv"</span>)
myDir.import &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/file.path.html">file.path</a></span>(<span class="st">"."</span>,<span class="st">"Data2_QC"</span>)
myDir.export &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/file.path.html">file.path</a></span>(<span class="st">"."</span>,<span class="st">"Data3_Aggregated"</span>)
myReport.format &lt;-<span class="st"> "html"</span>
<span class="kw"><a href="../reference/ContDataQC.html">ContDataQC</a></span>(myData.Operation, <span class="dt">fun.myDir.import=</span>myDir.import, <span class="dt">fun.myDir.export=</span>myDir.export, <span class="dt">fun.myFile=</span>myFile, myReport.format)

<span class="co"># Summary Stats</span>
myData.Operation &lt;-<span class="st"> "SummaryStats"</span> <span class="co">#Selection.Operation[4]</span>
myFile &lt;-<span class="st"> "QC_test2_AW_20130426_20130725.csv"</span>
<span class="co">#myFile &lt;- c("QC_test2_AW_20130426_20130725.csv", "QC_test2_AW_20130725_20131015.csv", "QC_test2_AW_20140901_20140930.csv")</span>
myDir.import &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/file.path.html">file.path</a></span>(<span class="st">"."</span>,<span class="st">"Data2_QC"</span>)
myDir.export &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/file.path.html">file.path</a></span>(<span class="st">"."</span>,<span class="st">"Data4_Stats"</span>)
<span class="co">#Leave off myReport.format and get default (docx).</span>
<span class="kw"><a href="../reference/ContDataQC.html">ContDataQC</a></span>(myData.Operation, <span class="dt">fun.myDir.import=</span>myDir.import, <span class="dt">fun.myDir.export=</span>myDir.export, <span class="dt">fun.myFile=</span>myFile)</code></pre></div>
</div>
<div id="other-features" class="section level2">
<h2 class="hasAnchor">
<a href="#other-features" class="anchor"></a>Other Features</h2>
<p>There are other features built into the <code>ContDataQC</code> library. These are outlined below.</p>
</div>
<div id="configuration-file" class="section level2">
<h2 class="hasAnchor">
<a href="#configuration-file" class="anchor"></a>Configuration File</h2>
<p>Through the use of a configuration file the user can change many of the variables in the library (e.g., the names of fields, thresholds, and date formats).</p>
<p>The ContDataQC() function allows the user to input their own configuration file. Only variables that are different from the default need to be added. That is, the default configuration is loaded in the library and then the user supplied configuration. This allows the user configuration to overwrite the defaults for that session.</p>
<p>The Config.out will output the contents of the configuration file as used by the package and stored in the environment ContData.env.</p>
<p>The contents of the configuration file (extdata/config.ORIG.R) are listed below.</p>
<pre><code># User Defined Values
#
# User defined values for variables used across multiple functions in this library.
# The user has the ability to modify the values for names, units, QC thresholds, etc.
#
# Saved in a separate environment.
#
# https://www.r-bloggers.com/package-wide-variablescache-in-r-packages/
#
# Continuous data helper script
# Default Values
# Erik.Leppo@tetratech.com (EWL)
# 20150928
# 20170323, add 3 parameters (Cond, DO, pH)
#~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
# User defined variable names for input data
#~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
# It is assumed that this R script is stored in a directory with the data files as subdirectories
# This script is intended to be "source"d from the main script.
#~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
# @keywords continuous data
# @examples
# #Not intended to be accessed indepedant of function ContDataQC().
# #Data values only.  No functions.  Add to environment so only visible inside library.
#~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
# USER may make modifications in this section but not mandatory
# this section could be sourced so can use between scripts
#~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
#UserDefinedValues &lt;- NA # default value so shows up in help files
#~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
# Environment Name ####
# Environment for use only by ContDataQC library
ContData.env &lt;- new.env(parent = emptyenv())
# assign variables to new environment requires editing of all lines.
# For example, myDelim &lt;- "_" BECOMES ContData.env$myDelim, "_"
###
# list all elements in environment
# ls(ContData.env)  # all elements in environment
# as.list(ContData.env)  # all elements in environment with assigned values
#~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
# Delimiter in File Names (e.g., test2_AW_201301_20131231.csv)
ContData.env$myDelim &lt;- "_"
ContData.env$myDelim_LakeID &lt;- "~"
#~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
# Acceptable column names for the data ####
## Basic
ContData.env$myName.SiteID        &lt;- "SiteID"
ContData.env$myName.Date          &lt;- "Date"
ContData.env$myName.Time          &lt;- "Time"
ContData.env$myName.DateTime      &lt;- "Date.Time"
#(special characters (e.g., %, space, or /) are converted to "." by R, "deg" converted to "A")
### IF CHANGE UNITS WILL NEED TO MODIFY THRESHOLDS ###
ContData.env$myUnits.AirTemp    &lt;- "C" # C or F
ContData.env$myUnits.WaterTemp  &lt;- ContData.env$myUnits.AirTemp
ContData.env$myUnits.AirBP      &lt;- "psi"
ContData.env$myUnits.WaterP     &lt;- ContData.env$myUnits.AirBP
ContData.env$myUnits.SensorDepth &lt;- "ft"
ContData.env$myUnits.Discharge  &lt;- "ft3.s"
ContData.env$myUnits.Cond       &lt;- "uS.cm"
ContData.env$myUnits.DO         &lt;- "mg.L"
ContData.env$myUnits.pH         &lt;- "SU"
ContData.env$myUnits.Turbidity  &lt;- "NTU"
ContData.env$myUnits.Chlorophylla &lt;- "g.cm3"
ContData.env$myUnits.GageHeight &lt;- "ft"
## Logger Fields
ContData.env$myName.RowID.Water   &lt;- "Water.RowID"
ContData.env$myName.LoggerID.Water&lt;- "Water.LoggerID"
ContData.env$myName.RowID.Air     &lt;- "Air.RowID"
ContData.env$myName.LoggerID.Air  &lt;- "Air.LoggerID"
## Parameters as appear in logger files
ContData.env$myName.WaterTemp     &lt;- paste0("Water.Temp.",ContData.env$myUnits.WaterTemp)  # "deg" from HoboWare files sometimes adds "A " in front.  Replace with "." in R.
ContData.env$myName.AirTemp       &lt;- paste0("Air.Temp.",ContData.env$myUnits.AirTemp)   # "deg" from HoboWare files sometimes adds "A " in front.  Replace with "." in R.
ContData.env$myName.WaterP        &lt;- paste0("Water.P.",ContData.env$myUnits.WaterP)
ContData.env$myName.AirBP         &lt;- paste0("Air.BP.",ContData.env$myUnits.WaterP)
ContData.env$myName.SensorDepth   &lt;- paste0("Sensor.Depth.",ContData.env$myUnits.SensorDepth)
ContData.env$myName.Discharge     &lt;- paste0("Discharge.",ContData.env$myUnits.Discharge)
ContData.env$myName.Cond          &lt;- paste0("Conductivity.",ContData.env$myUnits.Cond)
ContData.env$myName.DO            &lt;- paste0("DO.",ContData.env$myUnits.DO)
ContData.env$myName.pH            &lt;- paste0("pH.",ContData.env$myUnits.pH)
ContData.env$myName.Turbidity     &lt;- paste0("Turbidity.",ContData.env$myUnits.DO)
ContData.env$myName.Chlorophylla   &lt;- paste0("Chlorophylla.",ContData.env$myUnits.pH)
ContData.env$myName.GageHeight    &lt;- paste0("GageHeight.",ContData.env$myUnits.GageHeight)
## Plot Labels
ContData.env$myLab.WaterTemp      &lt;- paste0("Temperature, Water (deg ",ContData.env$myUnits.WaterTemp,")")
ContData.env$myLab.AirTemp        &lt;- paste0("Temperature, Air (deg ",ContData.env$myUnits.AirTemp,")")
ContData.env$myLab.Date           &lt;- "Date"
ContData.env$myLab.DateTime       &lt;- "Date"
ContData.env$myLab.WaterP         &lt;- paste0("Pressure, Water (",ContData.env$myUnits.AirBP,")")
ContData.env$myLab.AirBP          &lt;- paste0("Barometric Pressure, Air (",ContData.env$myUnits.WaterP,")")
ContData.env$myLab.SensorDepth    &lt;- paste0("Sensor Depth (",ContData.env$myUnits.SensorDepth,")",sep="")
ContData.env$myLab.Temp.BOTH      &lt;- paste0("Temperature (deg ",ContData.env$myUnits.WaterTemp,")")
ContData.env$myLab.Discharge      &lt;- paste0("Discharge (",sub("\\.","/",ContData.env$myUnits.Discharge),")")  #replace "." with "/"
ContData.env$myLab.Cond           &lt;- paste0("Conductivity (",sub("\\.","/",ContData.env$myUnits.Cond),")")    #replace "." with "/"
ContData.env$myLab.DO             &lt;- paste0("Dissolved Oxygen (",sub("\\.","/",ContData.env$myUnits.DO),")")  #replace "." with "/"
ContData.env$myLab.pH             &lt;- paste0("pH (",ContData.env$myUnits.pH,")")
ContData.env$myLab.Turbidity      &lt;- paste0("Turbidity (",ContData.env$myUnits.Turbidity,")")
ContData.env$myLab.Chlorophylla   &lt;- paste0("Chlorophyll a (",sub("\\.","/",ContData.env$myUnits.Chlorophylla),")")    #replace "." with "/"
ContData.env$myLab.GageHeight     &lt;- paste0("Gage Height (",ContData.env$myUnits.GageHeight,")")
#~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
# Discrete Measurements ####
ContData.env$myPrefix.Discrete          &lt;- "Discrete"
# Discrete, Names
ContData.env$myName.Discrete.WaterTemp  &lt;- paste(ContData.env$myPrefix.Discrete,ContData.env$myName.WaterTemp,sep=".")
ContData.env$myName.Discrete.AirTemp    &lt;- paste(ContData.env$myPrefix.Discrete,ContData.env$myName.AirTemp,sep=".")
ContData.env$myName.Discrete.WaterP     &lt;- paste(ContData.env$myPrefix.Discrete,ContData.env$myName.WaterP,sep=".")
ContData.env$myName.Discrete.AirBP      &lt;- paste(ContData.env$myPrefix.Discrete,ContData.env$myName.AirBP,sep=".")
ContData.env$myName.Discrete.SensorDepth &lt;- paste(ContData.env$myPrefix.Discrete,ContData.env$myName.SensorDepth,sep=".")
ContData.env$myName.Discrete.Discharge  &lt;- paste(ContData.env$myPrefix.Discrete,ContData.env$myName.Discharge,sep=".")
ContData.env$myName.Discrete.Cond       &lt;- paste(ContData.env$myPrefix.Discrete,ContData.env$myName.Cond,sep=".")
ContData.env$myName.Discrete.DO         &lt;- paste(ContData.env$myPrefix.Discrete,ContData.env$myName.DO,sep=".")
ContData.env$myName.Discrete.pH         &lt;- paste(ContData.env$myPrefix.Discrete,ContData.env$myName.pH,sep=".")
ContData.env$myName.Discrete.Turbidity  &lt;- paste(ContData.env$myPrefix.Discrete,ContData.env$myName.Turbidity,sep=".")
ContData.env$myName.Discrete.Chlorophylla &lt;- paste(ContData.env$myPrefix.Discrete,ContData.env$myName.Chlorophylla,sep=".")
ContData.env$myName.Discrete.GageHeight &lt;- paste(ContData.env$myPrefix.Discrete,ContData.env$myName.GageHeight,sep=".")
# Discrete, Labels
ContData.env$myLab.Discrete.WaterTemp   &lt;- paste(ContData.env$myLab.WaterTemp,"(Discrete)",sep=" ")
ContData.env$myLab.Discrete.AirTemp     &lt;- paste(ContData.env$myLab.AirTemp,"(Discrete)",sep=" ")
ContData.env$myLab.Discrete.WaterP      &lt;- paste(ContData.env$myLab.WaterP,"(Discrete)",sep=" ")
ContData.env$myLab.Discrete.AirBP       &lt;- paste(ContData.env$myLab.AirBP,"(Discrete)",sep=" ")
ContData.env$myLab.Discrete.SensorDepth &lt;- paste(ContData.env$myLab.SensorDepth,"(Discrete)",sep=" ")
ContData.env$myLab.Discrete.Discharge   &lt;- paste(ContData.env$myLab.Discharge,"(Discrete)",sep=" ")
ContData.env$myLab.Discrete.Cond        &lt;- paste(ContData.env$myLab.Cond,"(Discrete)",sep=" ")
ContData.env$myLab.Discrete.DO          &lt;- paste(ContData.env$myLab.DO,"(Discrete)",sep=" ")
ContData.env$myLab.Discrete.pH          &lt;- paste(ContData.env$myLab.pH,"(Discrete)",sep=" ")
ContData.env$myLab.Discrete.Turbidity   &lt;- paste(ContData.env$myLab.Turbidity,"(Discrete)",sep=" ")
ContData.env$myLab.Discrete.Chlorophylla&lt;- paste(ContData.env$myLab.Chlorophylla,"(Discrete)",sep=" ")
ContData.env$myLab.Discrete.GageHeight  &lt;- paste(ContData.env$myLab.GageHeight,"(Discrete)",sep=" ")
#~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
# Automated QC stuff ####
## data type/stages
ContData.env$myDataQuality.Raw        &lt;- "RAW"
ContData.env$myDataQuality.QCauto     &lt;- "QCauto"
ContData.env$myDataQuality.QCmanual   &lt;- "QCmanual"
ContData.env$myDataQuality.Final      &lt;- "Final"
ContData.env$myDataQuality.Aggregated &lt;- "Aggregated"
#~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
# Directory Names ####
ContData.env$myName.Dir.0Original  &lt;- "Data0_Original"
ContData.env$myName.Dir.1Raw       &lt;- "Data1_Raw"
ContData.env$myName.Dir.2QC        &lt;- "Data2_QC"
ContData.env$myName.Dir.3Agg       &lt;- "Data3_Aggregated"
ContData.env$myName.Dir.4Stats     &lt;- "Data4_Stats"
#~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
# Data Fields ####
ContData.env$myNames.DataFields &lt;- c(ContData.env$myName.WaterTemp
                                     , ContData.env$myName.AirTemp
                                     , ContData.env$myName.WaterP
                                     , ContData.env$myName.AirBP
                                     , ContData.env$myName.SensorDepth
                                     , ContData.env$myName.Discharge
                                     , ContData.env$myName.Cond
                                     , ContData.env$myName.DO
                                     , ContData.env$myName.pH
                                     , ContData.env$myName.Turbidity
                                     , ContData.env$myName.Chlorophylla
                                     , ContData.env$myName.GageHeight
                                     , ContData.env$myName.Discrete.WaterTemp
                                     , ContData.env$myName.Discrete.AirTemp
                                     , ContData.env$myName.Discrete.WaterP
                                     , ContData.env$myName.Discrete.AirBP
                                     , ContData.env$myName.Discrete.SensorDepth
                                     , ContData.env$myName.Discrete.Discharge
                                     , ContData.env$myName.Discrete.Cond
                                     , ContData.env$myName.Discrete.DO
                                     , ContData.env$myName.Discrete.pH
                                     , ContData.env$myName.Discrete.Turbidity
                                     , ContData.env$myName.Discrete.Chlorophylla
                                     , ContData.env$myName.Discrete.GageHeight
                                     )
ContData.env$myNames.DataFields.Lab &lt;- c(ContData.env$myLab.WaterTemp
                                         , ContData.env$myLab.AirTemp
                                         , ContData.env$myLab.WaterP
                                         , ContData.env$myLab.AirBP
                                         , ContData.env$myLab.SensorDepth
                                         , ContData.env$myLab.Discharge
                                         , ContData.env$myLab.Cond
                                         , ContData.env$myLab.DO
                                         , ContData.env$myLab.pH
                                         , ContData.env$myLab.Turbidity
                                         , ContData.env$myLab.Chlorophylla
                                         , ContData.env$myLab.GageHeight
                                         , ContData.env$myLab.Discrete.WaterTemp
                                         , ContData.env$myLab.Discrete.AirTemp
                                         , ContData.env$myLab.Discrete.WaterP
                                         , ContData.env$myLab.Discrete.AirBP
                                         , ContData.env$myLab.Discrete.SensorDepth
                                         , ContData.env$myLab.Discrete.Discharge
                                         , ContData.env$myLab.Discrete.Cond
                                         , ContData.env$myLab.Discrete.DO
                                         , ContData.env$myLab.Discrete.pH
                                         , ContData.env$myLab.Discrete.Turbidity
                                         , ContData.env$myLab.Discrete.Chlorophylla
                                         , ContData.env$myLab.Discrete.GageHeight
                                         )
ContData.env$myNames.DataFields.Col &lt;- c("blue","green","gray","gray","black","brown"
                                         ,"purple","orange","salmon","rosybrown","aquamarine1")
#
## Name Order (change order below to change order in output file)
ContData.env$myNames.Order &lt;- c(ContData.env$myName.SiteID
                                , ContData.env$myName.Date
                                , ContData.env$myName.Time
                                , ContData.env$myName.DateTime
                                , ContData.env$myName.WaterTemp
                                , ContData.env$myName.LoggerID.Air
                                , ContData.env$myName.RowID.Air
                                , ContData.env$myName.AirTemp
                                , ContData.env$myName.WaterP
                                , ContData.env$myName.AirBP
                                , ContData.env$myName.SensorDepth
                                , ContData.env$myName.Discharge
                                , ContData.env$myName.Cond
                                , ContData.env$myName.DO
                                , ContData.env$myName.pH
                                , ContData.env$myName.Turbidity
                                , ContData.env$myName.Chlorophylla
                                , ContData.env$myName.GageHeight
                                , ContData.env$myName.LoggerID.Water
                                , ContData.env$myName.RowID.Water
                                , ContData.env$myName.Discrete.WaterTemp
                                , ContData.env$myName.Discrete.AirTemp
                                , ContData.env$myName.Discrete.WaterP
                                , ContData.env$myName.Discrete.AirBP
                                , ContData.env$myName.Discrete.SensorDepth
                                , ContData.env$myName.Discrete.Discharge
                                , ContData.env$myName.Discrete.Cond
                                , ContData.env$myName.Discrete.DO
                                , ContData.env$myName.Discrete.pH
                                , ContData.env$myName.Discrete.Turbidity
                                , ContData.env$myName.Discrete.Chlorophylla
                                , ContData.env$myName.Discrete.GageHeight
                                )
#~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
## Data Quality Flag Values ####
ContData.env$myFlagVal.Pass    &lt;- "P"
ContData.env$myFlagVal.NotEval &lt;- "NA"
ContData.env$myFlagVal.Suspect &lt;- "S"
ContData.env$myFlagVal.Fail    &lt;- "F"
ContData.env$myFlagVal.NoData  &lt;- "X"
ContData.env$myFlagVal.Order   &lt;- c(ContData.env$myFlagVal.Pass
                                    , ContData.env$myFlagVal.Suspect
                                    , ContData.env$myFlagVal.Fail
                                    , ContData.env$myFlagVal.NoData)
#~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
# QC Tests and Calculations ####
#http://stackoverflow.com/questions/16143700/pasting-two-vectors-with-combinations-of-all-vectors-elements
#myNames.QCTests.Calcs.combo &lt;- as.vector(t(outer(myNames.QCTests,myNames.QCTests.Calcs,paste,sep=".")))
# combine so can check for and remove later.
#myNames.DataFields.QCTests.Calcs.combo &lt;- as.vector(t(outer(myNames.DataFields,myNames.QCTests.Calcs.combo,paste,sep=".")))
# Data Quality Flag Thresholds
## Gross Min/Max, Fail (equipment)
### Examines values as outliers versus threholds
### if value &gt;= Hi or &lt;= Lo then flagged as "Fail"
ContData.env$myThresh.Gross.Fail.Hi.WaterTemp  &lt;- 30
ContData.env$myThresh.Gross.Fail.Lo.WaterTemp  &lt;- -2
ContData.env$myThresh.Gross.Fail.Hi.AirTemp    &lt;- 38
ContData.env$myThresh.Gross.Fail.Lo.AirTemp    &lt;- -25
ContData.env$myThresh.Gross.Fail.Hi.WaterP     &lt;- 17
ContData.env$myThresh.Gross.Fail.Lo.WaterP     &lt;- 13
ContData.env$myThresh.Gross.Fail.Hi.AirBP      &lt;- 15
ContData.env$myThresh.Gross.Fail.Lo.AirBP      &lt;- 13
ContData.env$myThresh.Gross.Fail.Hi.SensorDepth &lt;- 6   # no longer used (only check for negative values for SensorDepth)
ContData.env$myThresh.Gross.Fail.Lo.SensorDepth &lt;- -1  # no longer used (only check for negative values for SensorDepth)
ContData.env$myThresh.Gross.Fail.Hi.Discharge  &lt;-  10^5 #dependant upon stream size (only checkf or negative values)
ContData.env$myThresh.Gross.Fail.Lo.Discharge  &lt;-  -1  #dependant upon stream size
ContData.env$myThresh.Gross.Fail.Hi.Cond       &lt;- 1500 # this threshold has not been closely evaluated
ContData.env$myThresh.Gross.Fail.Lo.Cond       &lt;- 10   # this threshold has not been closely evaluated
ContData.env$myThresh.Gross.Fail.Hi.DO         &lt;- 20   # this threshold has not been closely evaluated
ContData.env$myThresh.Gross.Fail.Lo.DO         &lt;- 1    # this threshold has not been closely evaluated
ContData.env$myThresh.Gross.Fail.Hi.pH         &lt;- 12   # this threshold has not been closely evaluated
ContData.env$myThresh.Gross.Fail.Lo.pH         &lt;- 3    # this threshold has not been closely evaluated
ContData.env$myThresh.Gross.Fail.Hi.Turbidity         &lt;- 10^5     # this threshold has not been closely evaluated
ContData.env$myThresh.Gross.Fail.Lo.Turbidity         &lt;- -1       # this threshold has not been closely evaluated
ContData.env$myThresh.Gross.Fail.Hi.Chlorophylla         &lt;- 10^5  # this threshold has not been closely evaluated
ContData.env$myThresh.Gross.Fail.Lo.Chlorophylla          &lt;- -1   # this threshold has not been closely evaluated
ContData.env$myThresh.Gross.Fail.Hi.GageHeight         &lt;- 10^5
ContData.env$myThresh.Gross.Fail.Lo.GageHeight          &lt;- -1
## Gross Min/Max, Suspect (extreme)
### Examines values as outliers versus threholds
### if value &gt;= Hi or &lt;= Lo then flagged as "Suspect"
ContData.env$myThresh.Gross.Suspect.Hi.WaterTemp  &lt;- 25
ContData.env$myThresh.Gross.Suspect.Lo.WaterTemp  &lt;- -0.1
ContData.env$myThresh.Gross.Suspect.Hi.AirTemp    &lt;- 35
ContData.env$myThresh.Gross.Suspect.Lo.AirTemp    &lt;- -23
ContData.env$myThresh.Gross.Suspect.Hi.WaterP     &lt;- 16.8
ContData.env$myThresh.Gross.Suspect.Lo.WaterP     &lt;- 13.5
ContData.env$myThresh.Gross.Suspect.Hi.AirBP      &lt;- 14.8
ContData.env$myThresh.Gross.Suspect.Lo.AirBP      &lt;- 13.0
ContData.env$myThresh.Gross.Suspect.Hi.SensorDepth &lt;- 5    # no longer used (only check for negative values for SensorDepth)
ContData.env$myThresh.Gross.Suspect.Lo.SensorDepth &lt;- 0    # no longer used (only check for negative values for SensorDepth)
ContData.env$myThresh.Gross.Suspect.Hi.Discharge  &lt;-  10^3 #dependant upon stream size (only checkf or negative values
ContData.env$myThresh.Gross.Suspect.Lo.Discharge  &lt;-  -1   #dependant upon stream size
ContData.env$myThresh.Gross.Suspect.Hi.Cond       &lt;- 1200  # this threshold has not been closely evaluated
ContData.env$myThresh.Gross.Suspect.Lo.Cond       &lt;- 20    # this threshold has not been closely evaluated
ContData.env$myThresh.Gross.Suspect.Hi.DO         &lt;- 18    # this threshold has not been closely evaluated
ContData.env$myThresh.Gross.Suspect.Lo.DO         &lt;- 2     # this threshold has not been closely evaluated
ContData.env$myThresh.Gross.Suspect.Hi.pH         &lt;- 11    # this threshold has not been closely evaluated
ContData.env$myThresh.Gross.Suspect.Lo.pH         &lt;- 4     # this threshold has not been closely evaluated
ContData.env$myThresh.Gross.Suspect.Hi.Turbidity         &lt;- 10^3     # this threshold has not been closely evaluated
ContData.env$myThresh.Gross.Suspect.Lo.Turbidity          &lt;- -1      # this threshold has not been closely evaluated
ContData.env$myThresh.Gross.Suspect.Hi.Chlorophylla         &lt;- 10^3  # this threshold has not been closely evaluated
ContData.env$myThresh.Gross.Suspect.Lo.Chlorophylla         &lt;- 1     # this threshold has not been closely evaluated
ContData.env$myThresh.Gross.Suspect.Hi.GageHeight         &lt;- 10^3
ContData.env$myThresh.Gross.Suspect.Lo.GageHeight        &lt;- 1
## Spike thresholds (absolute change)
### Examines difference between consecutive measurements
### if delta &gt;= Hi then flagged as "Fail"
### if delta &gt;= Lo then flagged as "Suspect"
ContData.env$myThresh.Spike.Hi.WaterTemp  &lt;- 1.5
ContData.env$myThresh.Spike.Lo.WaterTemp  &lt;- 1
ContData.env$myThresh.Spike.Hi.AirTemp    &lt;- 10
ContData.env$myThresh.Spike.Lo.AirTemp    &lt;- 8
ContData.env$myThresh.Spike.Hi.WaterP     &lt;- 0.7
ContData.env$myThresh.Spike.Lo.WaterP     &lt;- 0.5
ContData.env$myThresh.Spike.Hi.AirBP      &lt;- 0.25
ContData.env$myThresh.Spike.Lo.AirBP      &lt;- 0.15
ContData.env$myThresh.Spike.Hi.SensorDepth &lt;- 5
ContData.env$myThresh.Spike.Lo.SensorDepth &lt;- 3
ContData.env$myThresh.Spike.Hi.Discharge  &lt;- 10^4 # dependant upon stream size
ContData.env$myThresh.Spike.Lo.Discharge  &lt;- 10^3 # dependant upon stream size
ContData.env$myThresh.Spike.Hi.Cond       &lt;- 10   # this threshold has not been closely evaluated
ContData.env$myThresh.Spike.Lo.Cond       &lt;- 5    # this threshold has not been closely evaluated
ContData.env$myThresh.Spike.Hi.DO         &lt;- 10   # this threshold has not been closely evaluated
ContData.env$myThresh.Spike.Lo.DO         &lt;- 5    # this threshold has not been closely evaluated
ContData.env$myThresh.Spike.Hi.pH         &lt;- 10   # this threshold has not been closely evaluated
ContData.env$myThresh.Spike.Lo.pH         &lt;- 5    # this threshold has not been closely evaluated
ContData.env$myThresh.Spike.Hi.Turbidity         &lt;- 10^4         # this threshold has not been closely evaluated
ContData.env$myThresh.Spike.Lo.Turbidity         &lt;- 10^3         # this threshold has not been closely evaluated
ContData.env$myThresh.Spike.Hi.Chlorophylla         &lt;- 10^4      # this threshold has not been closely evaluated
ContData.env$myThresh.Spike.Lo.Chlorophylla         &lt;- 10^3      # this threshold has not been closely evaluated
ContData.env$myThresh.Spike.Hi.Chlorophylla         &lt;- 10^4      # this threshold has not been closely evaluated        # this threshold has not been closely evaluated
ContData.env$myThresh.Spike.Lo.Chlorophylla         &lt;- 10^3      # this threshold has not been closely evaluated
## Rate of Change (relative change)
### Examines SD over "period" and difference in consecutive values
### If delta &gt;= SD.number * SD then flagged as "Suspect"
ContData.env$myDefault.RoC.SD.number  &lt;- 3
ContData.env$myDefault.RoC.SD.period  &lt;- 25 #hours
ContData.env$myThresh.RoC.SD.number.WaterTemp  &lt;- ContData.env$myDefault.RoC.SD.number
ContData.env$myThresh.RoC.SD.period.WaterTemp  &lt;- ContData.env$myDefault.RoC.SD.period
ContData.env$myThresh.RoC.SD.number.AirTemp    &lt;- ContData.env$myDefault.RoC.SD.number
ContData.env$myThresh.RoC.SD.period.AirTemp    &lt;- ContData.env$myDefault.RoC.SD.period
ContData.env$myThresh.RoC.SD.number.WaterP     &lt;- ContData.env$myDefault.RoC.SD.number
ContData.env$myThresh.RoC.SD.period.WaterP     &lt;- ContData.env$myDefault.RoC.SD.period
ContData.env$myThresh.RoC.SD.number.AirBP      &lt;- ContData.env$myDefault.RoC.SD.number
ContData.env$myThresh.RoC.SD.period.AirBP      &lt;- ContData.env$myDefault.RoC.SD.period
ContData.env$myThresh.RoC.SD.number.SensorDepth &lt;- ContData.env$myDefault.RoC.SD.number
ContData.env$myThresh.RoC.SD.period.SensorDepth &lt;- ContData.env$myDefault.RoC.SD.period
ContData.env$myThresh.RoC.SD.number.Discharge  &lt;- ContData.env$myDefault.RoC.SD.number
ContData.env$myThresh.RoC.SD.period.Discharge  &lt;- ContData.env$myDefault.RoC.SD.period
ContData.env$myThresh.RoC.SD.number.Cond       &lt;- ContData.env$myDefault.RoC.SD.number
ContData.env$myThresh.RoC.SD.period.Cond       &lt;- ContData.env$myDefault.RoC.SD.period
ContData.env$myThresh.RoC.SD.number.DO         &lt;- ContData.env$myDefault.RoC.SD.number
ContData.env$myThresh.RoC.SD.period.DO         &lt;- ContData.env$myDefault.RoC.SD.period
ContData.env$myThresh.RoC.SD.number.pH         &lt;- ContData.env$myDefault.RoC.SD.number
ContData.env$myThresh.RoC.SD.period.pH         &lt;- ContData.env$myDefault.RoC.SD.period
ContData.env$myThresh.RoC.SD.number.Turbidity         &lt;- ContData.env$myDefault.RoC.SD.number
ContData.env$myThresh.RoC.SD.period.Turbidity         &lt;- ContData.env$myDefault.RoC.SD.period
ContData.env$myThresh.RoC.SD.number.Chlorophylla         &lt;- ContData.env$myDefault.RoC.SD.number
ContData.env$myThresh.RoC.SD.period.Chlorophylla        &lt;- ContData.env$myDefault.RoC.SD.period
ContData.env$myThresh.RoC.SD.number.GageHeight         &lt;- ContData.env$myDefault.RoC.SD.number
ContData.env$myThresh.RoC.SD.period.GageHeight        &lt;- ContData.env$myDefault.RoC.SD.period
## No Change (flat-line)
### Examines consecutive values within "Tolerance" of each other
### If number of consecutive values &gt;= Hi then flagged as "Fail"
### If number of consecutive values &gt;= Lo (and &lt; Hi) then flagged as "Suspect"
ContData.env$myDefault.Flat.Hi        &lt;- 30  # maximum is myThresh.Flat.MaxComp
ContData.env$myDefault.Flat.Lo        &lt;- 15
ContData.env$myDefault.Flat.Tolerance &lt;- 0.01 # set to one sigdig less than measurements.  Check with fivenum(x)
ContData.env$myThresh.Flat.Hi.WaterTemp         &lt;- 30
ContData.env$myThresh.Flat.Lo.WaterTemp         &lt;- 20
ContData.env$myThresh.Flat.Tolerance.WaterTemp  &lt;- 0.01
ContData.env$myThresh.Flat.Hi.AirTemp           &lt;- 20
ContData.env$myThresh.Flat.Lo.AirTemp           &lt;- 15
ContData.env$myThresh.Flat.Tolerance.AirTemp    &lt;- 0.01
ContData.env$myThresh.Flat.Hi.WaterP            &lt;- 15
ContData.env$myThresh.Flat.Lo.WaterP            &lt;- 10
ContData.env$myThresh.Flat.Tolerance.WaterP     &lt;- 0.001
ContData.env$myThresh.Flat.Hi.AirBP             &lt;- 15
ContData.env$myThresh.Flat.Lo.AirBP             &lt;- 10
ContData.env$myThresh.Flat.Tolerance.AirBP      &lt;- 0.001
ContData.env$myThresh.Flat.Hi.SensorDepth        &lt;- 60
ContData.env$myThresh.Flat.Lo.SensorDepth        &lt;- 20
ContData.env$myThresh.Flat.Tolerance.SensorDepth &lt;- 0.0
ContData.env$myThresh.Flat.Hi.Discharge         &lt;- ContData.env$myDefault.Flat.Hi * 2
ContData.env$myThresh.Flat.Lo.Discharge         &lt;- ContData.env$myDefault.Flat.Lo * 2
ContData.env$myThresh.Flat.Tolerance.Discharge  &lt;- 0.01
ContData.env$myThresh.Flat.Hi.Cond              &lt;- ContData.env$myDefault.Flat.Hi * 2
ContData.env$myThresh.Flat.Lo.Cond              &lt;- ContData.env$myDefault.Flat.Lo * 2
ContData.env$myThresh.Flat.Tolerance.Cond       &lt;- 0.01
ContData.env$myThresh.Flat.Hi.DO                &lt;- ContData.env$myDefault.Flat.Hi * 2
ContData.env$myThresh.Flat.Lo.DO                &lt;- ContData.env$myDefault.Flat.Lo * 2
ContData.env$myThresh.Flat.Tolerance.DO         &lt;- 0.01
ContData.env$myThresh.Flat.Hi.pH                &lt;- ContData.env$myDefault.Flat.Hi * 2
ContData.env$myThresh.Flat.Lo.pH                &lt;- ContData.env$myDefault.Flat.Lo * 2
ContData.env$myThresh.Flat.Tolerance.pH         &lt;- 0.01
ContData.env$myThresh.Flat.Hi.Turbidity               &lt;- ContData.env$myDefault.Flat.Hi * 2
ContData.env$myThresh.Flat.Lo.Turbidity               &lt;- ContData.env$myDefault.Flat.Lo * 2
ContData.env$myThresh.Flat.Tolerance.Turbidity        &lt;- 0.01
ContData.env$myThresh.Flat.Hi.Chlorophylla                &lt;- ContData.env$myDefault.Flat.Hi * 2
ContData.env$myThresh.Flat.Lo.Chlorophylla                &lt;- ContData.env$myDefault.Flat.Lo * 2
ContData.env$myThresh.Flat.Tolerance.Chlorophylla         &lt;- 0.01
ContData.env$myThresh.Flat.Hi.GageHeight               &lt;- ContData.env$myDefault.Flat.Hi * 2
ContData.env$myThresh.Flat.Lo.GageHeight               &lt;- ContData.env$myDefault.Flat.Lo * 2
ContData.env$myThresh.Flat.Tolerance.GageHeight        &lt;- 0.01
#
ContData.env$myThresh.Flat.MaxComp    &lt;- max(ContData.env$myThresh.Flat.Hi.WaterTemp
                                             , ContData.env$myThresh.Flat.Hi.AirTemp
                                             , ContData.env$myThresh.Flat.Hi.WaterP
                                             , ContData.env$myThresh.Flat.Hi.AirBP
                                             , ContData.env$myThresh.Flat.Hi.Discharge
                                             , ContData.env$myThresh.Flat.Hi.Cond
                                             , ContData.env$myThresh.Flat.Hi.DO
                                             , ContData.env$myThresh.Flat.Hi.pH
                                             , ContData.env$myThresh.Flat.Hi.Turbidity
                                             , ContData.env$myThresh.Flat.Hi.Chlorophylla
                                             , ContData.env$myThresh.Flat.Hi.GageHeight
                                             )
#~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
# Data Fields with Flags ####
ContData.env$myName.Flag        &lt;- "Flag" # flag prefix
ContData.env$myNames.Cols4Flags &lt;- c(ContData.env$myName.DateTime,ContData.env$myNames.DataFields)
ContData.env$myNames.Flags      &lt;- paste(ContData.env$myName.Flag,ContData.env$myNames.Cols4Flags,sep=".")  # define ones using in the calling script
## flag labels
ContData.env$myName.Flag.DateTime   &lt;- paste(ContData.env$myName.Flag,ContData.env$myName.DateTime,sep=".")
ContData.env$myName.Flag.WaterTemp  &lt;- paste(ContData.env$myName.Flag,ContData.env$myName.WaterTemp,sep=".")
ContData.env$myName.Flag.AirTemp    &lt;- paste(ContData.env$myName.Flag,ContData.env$myName.AirTemp,sep=".")
ContData.env$myName.Flag.WaterP     &lt;- paste(ContData.env$myName.Flag,ContData.env$myName.WaterP,sep=".")
ContData.env$myName.Flag.AirBP      &lt;- paste(ContData.env$myName.Flag,ContData.env$myName.AirBP,sep=".")
ContData.env$myName.Flag.SensorDepth &lt;- paste(ContData.env$myName.Flag,ContData.env$myName.SensorDepth,sep=".")
ContData.env$myName.Flag.Discharge  &lt;- paste(ContData.env$myName.Flag,ContData.env$myName.Discharge,sep=".")
ContData.env$myName.Flag.Cond       &lt;- paste(ContData.env$myName.Flag,ContData.env$myName.Cond,sep=".")
ContData.env$myName.Flag.DO         &lt;- paste(ContData.env$myName.Flag,ContData.env$myName.DO,sep=".")
ContData.env$myName.Flag.pH         &lt;- paste(ContData.env$myName.Flag,ContData.env$myName.pH,sep=".")
ContData.env$myName.Flag.Turbidity         &lt;- paste(ContData.env$myName.Flag,ContData.env$myName.Turbidity,sep=".")
ContData.env$myName.Flag.Chlorophylla        &lt;- paste(ContData.env$myName.Flag,ContData.env$myName.Chlorophylla,sep=".")
ContData.env$myName.Flag.GageHeight        &lt;- paste(ContData.env$myName.Flag,ContData.env$myName.GageHeight,sep=".")
# Data Quality Test Names
ContData.env$myNames.QCTests &lt;- c("Gross","Spike","RoC","Flat")
ContData.env$myNames.QCCalcs &lt;- c("SD.Time","SD","SDxN",paste("n",1:ContData.env$myThresh.Flat.MaxComp,sep="."),"flat.Lo","flat.Hi")
#~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
# Exceedance values for stats (default to Gross-Suspect-Hi value) ####
ContData.env$myExceed.WaterTemp  &lt;- ContData.env$myThresh.Gross.Suspect.Hi.WaterTemp
ContData.env$myExceed.AirTemp    &lt;- ContData.env$myThresh.Gross.Suspect.Hi.AirTemp
ContData.env$myExceed.SensorDepth &lt;- ContData.env$myThresh.Gross.Suspect.Hi.SensorDepth
#~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
# Date and Time Formats ####
ContData.env$myFormat.Date           &lt;- "%Y-%m-%d"
ContData.env$myFormat.Time           &lt;- "%H:%M:%S"
ContData.env$myFormat.DateTime       &lt;- "%Y-%m-%d %H:%M:%S"
ContData.env$DateRange.Start.Default &lt;- format(as.Date("1900-01-01"),ContData.env$myFormat.Date) #YYYY-MM-DD
ContData.env$DateRange.End.Default   &lt;- format(Sys.Date(),ContData.env$myFormat.Date)
# Time Zone, used in Gage script in dataRetrieval, OlsonNames()
ContData.env$myTZ &lt;- Sys.timezone() #"America/New_York" (local time zone)
#~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
# Time Frames (MM-DD) ####
ContData.env$myTimeFrame.Annual.Start        &lt;- "0101"
ContData.env$myTimeFrame.Annual.End          &lt;- "1231"
ContData.env$myTimeFrame.WaterYear.Start     &lt;- "1001"
#ContData.env$myTimeFrame.WaterYear.End      &lt;- "0930"
ContData.env$myTimeFrame.Season.Spring.Start &lt;- "0301"
#ContData.env$myTimeFrame.Season.Spring.End  &lt;- "0531"
ContData.env$myTimeFrame.Season.Summer.Start &lt;- "0601"
#ContData.env$myTimeFrame.Season.Summer.End  &lt;- "0831"
ContData.env$myTimeFrame.Season.Fall.Start   &lt;- "0901"
#ContData.env$myTimeFrame.Season.Fall.End    &lt;- "1130"
ContData.env$myTimeFrame.Season.Winter.Start &lt;- "1201"
#ContData.env$myTimeFrame.Season.Winter.End  &lt;- "0228" #but 0229 in leap year, use start dates only
# Time Frame Names
ContData.env$myName.Yr       &lt;- "Year"
ContData.env$myName.YrMo     &lt;- "YearMonth"
ContData.env$myName.Mo       &lt;- "Month"
ContData.env$myName.MoDa     &lt;- "MonthDay"
ContData.env$myName.JuDa     &lt;- "JulianDay"
ContData.env$myName.Day      &lt;- "Day"
ContData.env$myName.Season   &lt;- "Season"
ContData.env$myName.YrSeason &lt;- "YearSeason"
# for summary stats
ContData.env$myNames.Fields.TimePeriods &lt;- c(ContData.env$myName.Yr
                                            ,ContData.env$myName.YrMo
                                            ,ContData.env$myName.Mo
                                            ,ContData.env$myName.MoDa
                                            ,ContData.env$myName.JuDa
                                            ,ContData.env$myName.Season
                                            ,ContData.env$myName.YrSeason)
#~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
# Exclude Trigger ####
# Trigger for Stats to exclude (TRUE) or include (FALSE) where flag = "fail"
ContData.env$myStats.Fails.Exclude &lt;- TRUE  #FALSE #TRUE
#~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
# Report Format ####
ContData.env$myReport.Format &lt;- "html"  # "html" or "docx" # DOCX requires Pandoc.
ContData.env$myReport.Dir    &lt;- file.path(system.file(package="ContDataQC"), "rmd")</code></pre>
</div>
<div id="period-stats" class="section level2">
<h2 class="hasAnchor">
<a href="#period-stats" class="anchor"></a>Period Stats</h2>
<p>The function PeriodStats() generates daily stats (N, mean, min, max, range, std deviation) for the specified time period before a given date. Output is a multiple column CSV (Date and Parameter Name by statistic) and a report (HTML or DOCX) with plots.</p>
<p>The input is output of the QC function in ContDataQC. That is, a file with SiteID, Date, Time, Date.Time, and parameters.</p>
<p>To get different periods (30, 60, or 90 days) change function input “fun.myPeriod.N”. It is possible to provide a vector for Period.N and Period.Units.</p>
<p>The function returns a csv with daily means and a PDF summary with plots into the specified export directory for the specified time period before the given date.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># Save example file</span>
df.x &lt;-<span class="st"> </span>DATA_period_test2_Aw_20130101_<span class="dv">20141231</span>
<span class="kw"><a href="https://rdrr.io/r/utils/write.table.html">write.csv</a></span>(df.x,<span class="st">"DATA_period_test2_Aw_20130101_20141231.csv"</span>)

<span class="co"># function inputs</span>
myDate &lt;-<span class="st"> "2013-09-30"</span>
myDate.Format &lt;-<span class="st"> "%Y-%m-%d"</span>
myPeriod.N &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="dv">30</span>, <span class="dv">60</span>, <span class="dv">90</span>, <span class="dv">120</span>, <span class="dv">1</span>)
myPeriod.Units &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"d"</span>, <span class="st">"d"</span>, <span class="st">"d"</span>, <span class="st">"d"</span>, <span class="st">"y"</span>)
myFile &lt;-<span class="st"> "DATA_period_test2_Aw_20130101_20141231.csv"</span>
myDir.import &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/getwd.html">getwd</a></span>()
myDir.export &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/getwd.html">getwd</a></span>()
myParam.Name &lt;-<span class="st"> "Water.Temp.C"</span>
myDateTime.Name &lt;-<span class="st"> "Date.Time"</span>
myDateTime.Format &lt;-<span class="st"> "%Y-%m-%d %H:%M:%S"</span>
myThreshold &lt;-<span class="st"> </span><span class="dv">20</span>
myConfig &lt;-<span class="st"> ""</span>
myReport.format &lt;-<span class="st"> "docx"</span>

<span class="co"># Run Function</span>
## default report format (html)
<span class="kw"><a href="../reference/PeriodStats.html">PeriodStats</a></span>(myDate
          , myDate.Format
          , myPeriod.N
          , myPeriod.Units
          , myFile
          , myDir.import
          , myDir.export
          , myParam.Name
          , myDateTime.Name
          , myDateTime.Format
          , myThreshold
          , myConfig)</code></pre></div>
</div>
<div id="export-for-iha" class="section level2">
<h2 class="hasAnchor">
<a href="#export-for-iha" class="anchor"></a>Export for IHA</h2>
<p>The function Export.IHA() allows for the formatting of data for use with the Nature Conservancy’s IHA program as converted to R.</p>
<p><a href="https://www.conservationgateway.org/ConservationPractices/Freshwater/EnvironmentalFlows/MethodsandTools/IndicatorsofHydrologicAlteration/Pages/indicators-hydrologic-alt.aspx" class="uri">https://www.conservationgateway.org/ConservationPractices/Freshwater/EnvironmentalFlows/MethodsandTools/IndicatorsofHydrologicAlteration/Pages/indicators-hydrologic-alt.aspx</a></p>
<p><a href="https://github.com/jasonelaw/iha" class="uri">https://github.com/jasonelaw/iha</a></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># 1.  Get Gage Data</span>
<span class="co">#</span>
<span class="co"># 1.A. Use ContDataQC and Save (~1min for download)</span>
myData.Operation    &lt;-<span class="st"> "GetGageData"</span> <span class="co">#Selection.Operation[1]</span>
myData.SiteID       &lt;-<span class="st"> "01187300"</span> <span class="co"># Hubbard River near West Hartland, CT</span>
myData.Type         &lt;-<span class="st"> "Gage"</span>
myData.DateRange.Start  &lt;-<span class="st"> "2015-01-01"</span>
myData.DateRange.End    &lt;-<span class="st"> "2016-12-31"</span>
myDir.import &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/getwd.html">getwd</a></span>()
myDir.export &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/getwd.html">getwd</a></span>()
<span class="kw"><a href="../reference/ContDataQC.html">ContDataQC</a></span>(myData.Operation, myData.SiteID, myData.Type
           , myData.DateRange.Start, myData.DateRange.End
           , myDir.import, myDir.export)
<span class="co">#</span>
<span class="co"># 1.B. Use saved data</span>
myFile &lt;-<span class="st"> "01187300_Gage_20150101_20161231.csv"</span>
myCol.DateTime &lt;-<span class="st"> "Date.Time"</span>
myCol.Discharge &lt;-<span class="st"> "Discharge.ft3.s"</span>
<span class="co">#</span>
<span class="co"># 2. Prep Data</span>
myData.IHA &lt;-<span class="st"> </span><span class="kw"><a href="../reference/Export.IHA.html">Export.IHA</a></span>(myFile
                         , <span class="dt">fun.myCol.DateTime =</span> myCol.DateTime
                         , <span class="dt">fun.myCol.Parameter =</span> myCol.Discharge
                         )</code></pre></div>
<p>The example code below runs the data (generated above) through IHA package. This example makes use of the <code>XLConnect</code> R library to save the IHA output into a single Excel file. Before running the IHA code the <code>IHA</code> and <code>XLConnect</code> packages need to be installed. The <code>devtools</code> package allows for easy installation from GitHub (where the IHA package resides).</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># Install Libraries (if needed)</span>
<span class="kw"><a href="https://rdrr.io/r/utils/install.packages.html">install.packages</a></span>(<span class="st">"devtools"</span>)
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span>(devtools)
<span class="kw">install_github</span>(<span class="st">"jasonelaw/IHA"</span>)
<span class="kw"><a href="https://rdrr.io/r/utils/install.packages.html">install.packages</a></span>(<span class="st">"XLConnect"</span>)</code></pre></div>
<p>IHA example code below that uses the IHA.Export file and produces an Excel file of the IHA output.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co">#~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~</span>
<span class="co"># 3. Run IHA</span>
<span class="co"># Example using returned DF with IHA</span>
<span class="co">#~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~</span>
<span class="co"># User info</span>
SiteID &lt;-<span class="st"> </span>myData.SiteID
Notes.User &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/Sys.getenv.html">Sys.getenv</a></span>(<span class="st">"USERNAME"</span>)
<span class="co">#~~~~~</span>
<span class="co"># Library (load)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">require</a></span>(IHA)
<span class="kw"><a href="https://rdrr.io/r/base/library.html">require</a></span>(XLConnect)
<span class="co">#~~~~~</span>
<span class="co"># IHA</span>
myYr &lt;-<span class="st"> "calendar"</span> <span class="co"># "water" or "calendar"</span>
<span class="co"># IHA Metrics</span>
## IHA parameters group 1; Magnitude of monthly water conditions
Analysis.Group.<span class="dv">1</span> &lt;-<span class="st"> </span><span class="kw">group1</span>(myData.IHA, <span class="dt">year=</span>myYr)
## IHA parameters group 2: Magnitude of monthly water condition and include 12 parameters
Analysis.Group.<span class="dv">2</span> &lt;-<span class="st"> </span><span class="kw">group2</span>(myData.IHA, <span class="dt">year=</span>myYr)
Analysis.Group.<span class="dv">3</span> &lt;-<span class="st"> </span><span class="kw">group3</span>(myData.IHA, <span class="dt">year=</span>myYr)
## IHA parameters group 4; Frequency and duration of high and low pulses
<span class="co"># defaults to 25th and 75th percentiles</span>
Analysis.Group.<span class="dv">4</span> &lt;-<span class="st"> </span><span class="kw">group4</span>(myData.IHA, <span class="dt">year=</span>myYr)
## IHA parameters group 5; Rate and frequency of water condition changes
Analysis.Group.<span class="dv">5</span> &lt;-<span class="st"> </span><span class="kw">group5</span>(myData.IHA, <span class="dt">year=</span>myYr)
<span class="co">#~~~~~</span>
<span class="co"># Save Results to Excel (each group on its own worksheet)</span>
Group.Desc &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"Magnitude of monthly water conditions"</span>
                ,<span class="st">"Magnitude of monthly water condition and include 12 parameters"</span>
                ,<span class="st">"Timing of annual extreme water conditions"</span>
                ,<span class="st">"Frequency and duration of high and low pulses"</span>
                ,<span class="st">"Rate and frequency of water condition changes"</span>)
df.Groups &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/as.data.frame.html">as.data.frame</a></span>(<span class="kw"><a href="https://rdrr.io/r/base/cbind.html">cbind</a></span>(<span class="kw"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span>(<span class="st">"Group"</span>,<span class="dv">1</span><span class="op">:</span><span class="dv">5</span>),Group.Desc))
<span class="co">#</span>
myDate &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/format.html">format</a></span>(<span class="kw"><a href="https://rdrr.io/r/base/Sys.time.html">Sys.Date</a></span>(),<span class="st">"%Y%m%d"</span>)
myTime &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/format.html">format</a></span>(<span class="kw"><a href="https://rdrr.io/r/base/Sys.time.html">Sys.time</a></span>(),<span class="st">"%H%M%S"</span>)
<span class="co"># Notes section (add min/max dates)</span>
Notes.Names &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"Dataset (SiteID)"</span>,<span class="st">"IHA.Year"</span>,<span class="st">"Analysis.Date (YYYYMMDD)"</span>,<span class="st">"Analysis.Time (HHMMSS)"</span>,<span class="st">"Analysis.User"</span>)
Notes.Data &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(SiteID, myYr, myDate, myTime, Notes.User)
df.Notes &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/as.data.frame.html">as.data.frame</a></span>(<span class="kw"><a href="https://rdrr.io/r/base/cbind.html">cbind</a></span>(Notes.Names,Notes.Data))
Notes.Summary &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/summary.html">summary</a></span>(myData.IHA)
<span class="co"># Open/Create file</span>
myFile.XLSX &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/paste.html">paste</a></span>(<span class="st">"IHA"</span>, SiteID, myYr, myDate, myTime, <span class="st">"xlsx"</span>, <span class="dt">sep=</span><span class="st">"."</span>)
wb &lt;-<span class="st"> </span><span class="kw">loadWorkbook</span>(myFile.XLSX, <span class="dt">create =</span> <span class="ot">TRUE</span>) <span class="co"># load workbook, create if not existing</span>
<span class="co"># create sheets</span>
<span class="kw">createSheet</span>(wb, <span class="dt">name =</span> <span class="st">"NOTES"</span>)
<span class="kw">createSheet</span>(wb, <span class="dt">name =</span> <span class="st">"Group1"</span>)
<span class="kw">createSheet</span>(wb, <span class="dt">name =</span> <span class="st">"Group2"</span>)
<span class="kw">createSheet</span>(wb, <span class="dt">name =</span> <span class="st">"Group3"</span>)
<span class="kw">createSheet</span>(wb, <span class="dt">name =</span> <span class="st">"Group4"</span>)
<span class="kw">createSheet</span>(wb, <span class="dt">name =</span> <span class="st">"Group5"</span>)
<span class="co"># write to worksheet</span>
<span class="kw">writeWorksheet</span>(wb, df.Notes, <span class="dt">sheet =</span> <span class="st">"NOTES"</span>, <span class="dt">startRow=</span><span class="dv">1</span>)
<span class="kw">writeWorksheet</span>(wb, Notes.Summary, <span class="dt">sheet =</span> <span class="st">"NOTES"</span>, <span class="dt">startRow=</span><span class="dv">10</span>)
<span class="kw">writeWorksheet</span>(wb, df.Groups, <span class="dt">sheet=</span><span class="st">"NOTES"</span>, <span class="dt">startRow=</span><span class="dv">25</span>)
<span class="kw">writeWorksheet</span>(wb, Analysis.Group.<span class="dv">1</span>, <span class="dt">sheet =</span> <span class="st">"Group1"</span>)
<span class="kw">writeWorksheet</span>(wb, Analysis.Group.<span class="dv">2</span>, <span class="dt">sheet =</span> <span class="st">"Group2"</span>)
<span class="kw">writeWorksheet</span>(wb, Analysis.Group.<span class="dv">3</span>, <span class="dt">sheet =</span> <span class="st">"Group3"</span>)
<span class="kw">writeWorksheet</span>(wb, Analysis.Group.<span class="dv">4</span>, <span class="dt">sheet =</span> <span class="st">"Group4"</span>)
<span class="kw">writeWorksheet</span>(wb, Analysis.Group.<span class="dv">5</span>, <span class="dt">sheet =</span> <span class="st">"Group5"</span>)
<span class="co"># save workbook</span>
<span class="kw">saveWorkbook</span>(wb, myFile.XLSX)</code></pre></div>
</div>
<div id="rarify-taxa-data" class="section level2">
<h2 class="hasAnchor">
<a href="#rarify-taxa-data" class="anchor"></a>Rarify Taxa Data</h2>
<p>At times benthic samples include more individuals than the target number or when combining data from multiple programs it is necessary to subsample all samples down to a common number. The rarify funtion is part of the RIVPACS set of R scripts written by USEPA Corvallis. The rarify function is in the package BioMonTools. The example below is from the help file from that package. The BioMonTools package should install with the ContDataQC package.</p>
<p><a href="https://github.com/leppott/BioMonTools" class="uri">https://github.com/leppott/BioMonTools</a></p>
<p>The function takes a three column data frame (SampleID, TaxonID, Count) and returns a similar dataframe with revised Counts.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># library(BioMonTools)</span>

<span class="co"># Subsample to 500 organisms (from over 500 organisms) for 12 samples.</span>

<span class="co"># load bio data</span>
df_biodata &lt;-<span class="st"> </span>data_bio2rarify
<span class="kw"><a href="https://rdrr.io/r/base/dim.html">dim</a></span>(df_biodata)
<span class="kw"><a href="https://rdrr.io/r/utils/View.html">View</a></span>(df_biodata)

<span class="co"># subsample</span>
mySize &lt;-<span class="st"> </span><span class="dv">500</span>
Seed_OR &lt;-<span class="st"> </span><span class="dv">18590214</span>
Seed_WA &lt;-<span class="st"> </span><span class="dv">18891111</span>
Seed_US &lt;-<span class="st"> </span><span class="dv">17760704</span>
bugs_mysize &lt;-<span class="st"> </span>BioMonTools<span class="op">::</span><span class="kw"><a href="https://rdrr.io/pkg/BioMonTools/man/rarify.html">rarify</a></span>(<span class="dt">inbug=</span>df_biodata, <span class="dt">sample.ID=</span><span class="st">"SampleID"</span>
                     ,<span class="dt">abund=</span><span class="st">"N_Taxa"</span>,<span class="dt">subsiz=</span>mySize, <span class="dt">mySeed=</span>Seed_US)

<span class="co"># view results</span>
<span class="kw"><a href="https://rdrr.io/r/base/dim.html">dim</a></span>(bugs_mysize)
<span class="kw"><a href="https://rdrr.io/r/utils/View.html">View</a></span>(bugs_mysize)

<span class="co"># Compare pre- and post- subsample counts</span>
df_compare &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/merge.html">merge</a></span>(df_biodata, bugs_mysize, <span class="dt">by=</span><span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"SampleID"</span>, <span class="st">"TaxaID"</span>)
                    , <span class="dt">suffixes =</span> <span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"_Orig"</span>,<span class="st">"_500"</span>))
df_compare &lt;-<span class="st"> </span>df_compare[,<span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"SampleID"</span>, <span class="st">"TaxaID"</span>, <span class="st">"N_Taxa_Orig"</span>, <span class="st">"N_Taxa_500"</span>)]
<span class="kw"><a href="https://rdrr.io/r/utils/View.html">View</a></span>(df_compare)

<span class="co"># compare totals</span>
tbl_totals &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/stats/aggregate.html">aggregate</a></span>(<span class="kw"><a href="https://rdrr.io/r/base/cbind.html">cbind</a></span>(N_Taxa_Orig, N_Taxa_<span class="dv">500</span>) <span class="op">~</span><span class="st"> </span>SampleID, df_compare, sum)
<span class="kw"><a href="https://rdrr.io/r/utils/View.html">View</a></span>(tbl_totals)

## Not run: 
<span class="co"># save the data</span>
<span class="kw"><a href="https://rdrr.io/r/utils/write.table.html">write.table</a></span>(bugs_mysize, <span class="kw"><a href="https://rdrr.io/r/base/paste.html">paste</a></span>(<span class="st">"bugs"</span>,mySize,<span class="st">"txt"</span>,<span class="dt">sep=</span><span class="st">"."</span>),<span class="dt">sep=</span><span class="st">"</span><span class="ch">\t</span><span class="st">"</span>)
## End(Not run)</code></pre></div>
</div>
<div id="visualization-of-daily-means" class="section level2">
<h2 class="hasAnchor">
<a href="#visualization-of-daily-means" class="anchor"></a>Visualization of Daily Means</h2>
<p>An Excel file is included in the folder of the library that allows for the plotting of up to five years of data for water temperature, sensor depth, and air temperature.</p>
<p>The daily values from the SummaryStats operation of the ContDataQC() function can be copied into the Excel file and the plots are auto-updated.</p>
<p>These plots could be created in R but the Excel file was included to make the plots available to a wider audience.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># Parameters</span>
Selection.Operation &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"GetGageData"</span>,<span class="st">"QCRaw"</span>, <span class="st">"Aggregate"</span>, <span class="st">"SummaryStats"</span>)
Selection.Type      &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"Air"</span>,<span class="st">"Water"</span>,<span class="st">"AW"</span>,<span class="st">"Gage"</span>,<span class="st">"AWG"</span>,<span class="st">"AG"</span>,<span class="st">"WG"</span>)
Selection.SUB &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"Data0_Original"</span>,<span class="st">"Data1_RAW"</span>,<span class="st">"Data2_QC"</span>,<span class="st">"Data3_Aggregated"</span>,<span class="st">"Data4_Stats"</span>)
myDir.BASE &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/getwd.html">getwd</a></span>()
<span class="co"># Summary Stats</span>
myData.Operation &lt;-<span class="st"> "SummaryStats"</span> <span class="co">#Selection.Operation[4]</span>
myData.SiteID    &lt;-<span class="st"> "test2"</span>
myData.Type      &lt;-<span class="st"> </span>Selection.Type[<span class="dv">3</span>] <span class="co">#"AW"</span>
myData.DateRange.Start  &lt;-<span class="st"> "2013-01-01"</span>
myData.DateRange.End    &lt;-<span class="st"> "2014-12-31"</span>
myDir.import &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/file.path.html">file.path</a></span>(myDir.BASE,Selection.SUB[<span class="dv">4</span>]) <span class="co">#"Data3_Aggregated"</span>
myDir.export &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/file.path.html">file.path</a></span>(myDir.BASE,Selection.SUB[<span class="dv">5</span>]) <span class="co">#"Data4_Stats"</span>
<span class="kw"><a href="../reference/ContDataQC.html">ContDataQC</a></span>(myData.Operation, myData.SiteID, myData.Type, myData.DateRange.Start, myData.DateRange.End, myDir.import, myDir.export)</code></pre></div>
</div>
<div id="output-for-streamthermal" class="section level2">
<h2 class="hasAnchor">
<a href="#output-for-streamthermal" class="anchor"></a>Output for StreamThermal</h2>
<p>The Export.StreamThermal() function exports data for use with the the <code>StreamThermal</code> library.<br>
The data input for StreamThermal is a data frame with five columns (SiteID, Date, TMax, TMin, and TMean).</p>
<p>The <code>StreamThermal</code> library is only available on GitHub.</p>
<p><a href="https://github.com/tsangyp/StreamThermal" class="uri">https://github.com/tsangyp/StreamThermal</a></p>
<p>Install instructions for the <code>StreamThermal</code> library are below.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># Install Libraries (if needed)</span>
<span class="kw"><a href="https://rdrr.io/r/utils/install.packages.html">install.packages</a></span>(<span class="st">"devtools"</span>)
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span>(devtools)
<span class="kw">install_github</span>(<span class="st">"tsangyp/StreamThermal"</span>)</code></pre></div>
<p>The <code>StreamThermal</code> package is set up to work with USGS gage data and this can be downloaded via the <code>dataRetrieval</code> library (as shown in the examples in the <code>StreamThermal</code> library).</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># 1.1. Get USGS data</span>
<span class="co"># code from StreamThermal T_frequency example</span>
ExUSGSStreamTemp&lt;-dataRetrieval<span class="op">::</span><span class="kw"><a href="https://rdrr.io/pkg/dataRetrieval/man/readNWISdv.html">readNWISdv</a></span>(<span class="st">"01382310"</span>,<span class="st">"00010"</span>,<span class="st">"2011-01-01"</span>,<span class="st">"2011-12-31"</span>
                                            ,<span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"00001"</span>,<span class="st">"00002"</span>,<span class="st">"00003"</span>))
sitedata&lt;-<span class="kw"><a href="https://rdrr.io/r/base/subset.html">subset</a></span>(ExUSGSStreamTemp, <span class="dt">select=</span><span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"site_no"</span>,<span class="st">"Date"</span>,<span class="st">"X_00010_00001"</span>,<span class="st">"X_00010_00002"</span>,<span class="st">"X_00010_00003"</span>))
<span class="kw"><a href="https://rdrr.io/r/base/names.html">names</a></span>(sitedata)&lt;-<span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"siteID"</span>,<span class="st">"Date"</span>,<span class="st">"MaxT"</span>,<span class="st">"MinT"</span>,<span class="st">"MeanT"</span>)
knitr<span class="op">::</span><span class="kw"><a href="https://rdrr.io/pkg/knitr/man/kable.html">kable</a></span>(<span class="kw"><a href="https://rdrr.io/r/utils/head.html">head</a></span>(sitedata))</code></pre></div>
<table class="table">
<thead><tr class="header">
<th align="left">siteID</th>
<th align="left">Date</th>
<th align="right">MaxT</th>
<th align="right">MinT</th>
<th align="right">MeanT</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">01382310</td>
<td align="left">2011-01-01</td>
<td align="right">3.7</td>
<td align="right">2.0</td>
<td align="right">2.6</td>
</tr>
<tr class="even">
<td align="left">01382310</td>
<td align="left">2011-01-02</td>
<td align="right">3.3</td>
<td align="right">2.1</td>
<td align="right">2.8</td>
</tr>
<tr class="odd">
<td align="left">01382310</td>
<td align="left">2011-01-03</td>
<td align="right">2.3</td>
<td align="right">1.0</td>
<td align="right">1.7</td>
</tr>
<tr class="even">
<td align="left">01382310</td>
<td align="left">2011-01-04</td>
<td align="right">2.7</td>
<td align="right">1.2</td>
<td align="right">1.8</td>
</tr>
<tr class="odd">
<td align="left">01382310</td>
<td align="left">2011-01-05</td>
<td align="right">2.8</td>
<td align="right">1.5</td>
<td align="right">2.0</td>
</tr>
<tr class="even">
<td align="left">01382310</td>
<td align="left">2011-01-06</td>
<td align="right">2.6</td>
<td align="right">1.2</td>
<td align="right">1.8</td>
</tr>
</tbody>
</table>
<p>It is possible to use data that has been summarized with SummaryStats.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># 1.2. Use Unsummarrized data</span>
myFile &lt;-<span class="st"> "DATA_test2_Aw_20130101_20141231.csv"</span>
myData &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/utils/read.table.html">read.csv</a></span>(<span class="kw"><a href="https://rdrr.io/r/base/file.path.html">file.path</a></span>(<span class="kw"><a href="https://rdrr.io/r/base/find.package.html">path.package</a></span>(<span class="st">"ContDataQC"</span>),<span class="st">"extdata"</span>,myFile), <span class="dt">stringsAsFactors=</span><span class="ot">FALSE</span>)
<span class="co"># Subset</span>
Col.Keep &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"SiteID"</span>, <span class="st">"Date"</span>, <span class="st">"Water.Temp.C"</span>)
sitedata &lt;-<span class="st"> </span>myData[,Col.Keep]
sitedata &lt;-<span class="st"> </span><span class="kw"><a href="../reference/Export.StreamThermal.html">Export.StreamThermal</a></span>(myData)
<span class="co"># Show data table</span>
knitr<span class="op">::</span><span class="kw"><a href="https://rdrr.io/pkg/knitr/man/kable.html">kable</a></span>(<span class="kw"><a href="https://rdrr.io/r/utils/head.html">head</a></span>(sitedata))</code></pre></div>
<table class="table">
<thead><tr class="header">
<th align="left">SiteID</th>
<th align="left">Date</th>
<th align="right">MaxT</th>
<th align="right">MinT</th>
<th align="right">MeanT</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">Test2</td>
<td align="left">2013-04-26</td>
<td align="right">13.846</td>
<td align="right">10.063</td>
<td align="right">12.88004</td>
</tr>
<tr class="even">
<td align="left">Test2</td>
<td align="left">2013-04-27</td>
<td align="right">13.173</td>
<td align="right">12.207</td>
<td align="right">12.52940</td>
</tr>
<tr class="odd">
<td align="left">Test2</td>
<td align="left">2013-04-28</td>
<td align="right">12.883</td>
<td align="right">12.594</td>
<td align="right">12.74052</td>
</tr>
<tr class="even">
<td align="left">Test2</td>
<td align="left">2013-04-29</td>
<td align="right">14.421</td>
<td align="right">12.497</td>
<td align="right">13.31387</td>
</tr>
<tr class="odd">
<td align="left">Test2</td>
<td align="left">2013-04-30</td>
<td align="right">15.091</td>
<td align="right">11.722</td>
<td align="right">13.41990</td>
</tr>
<tr class="even">
<td align="left">Test2</td>
<td align="left">2013-05-01</td>
<td align="right">15.569</td>
<td align="right">13.846</td>
<td align="right">14.63417</td>
</tr>
</tbody>
</table>
<p>It is also possible to use data that has been calculated by Period Stats.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># 1.3. Use user data that has been QCed</span>
myData &lt;-<span class="st"> </span>DATA_period_test2_Aw_20130101_<span class="dv">20141231</span>
sitedata &lt;-<span class="st"> </span><span class="kw"><a href="../reference/Export.StreamThermal.html">Export.StreamThermal</a></span>(myData)
knitr<span class="op">::</span><span class="kw"><a href="https://rdrr.io/pkg/knitr/man/kable.html">kable</a></span>(<span class="kw"><a href="https://rdrr.io/r/utils/head.html">head</a></span>(sitedata))</code></pre></div>
<table class="table">
<thead><tr class="header">
<th align="left">SiteID</th>
<th align="left">Date</th>
<th align="right">MaxT</th>
<th align="right">MinT</th>
<th align="right">MeanT</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">Test2</td>
<td align="left">2013-04-26</td>
<td align="right">13.846</td>
<td align="right">10.063</td>
<td align="right">12.88004</td>
</tr>
<tr class="even">
<td align="left">Test2</td>
<td align="left">2013-04-27</td>
<td align="right">13.173</td>
<td align="right">12.207</td>
<td align="right">12.52940</td>
</tr>
<tr class="odd">
<td align="left">Test2</td>
<td align="left">2013-04-28</td>
<td align="right">12.883</td>
<td align="right">12.594</td>
<td align="right">12.74052</td>
</tr>
<tr class="even">
<td align="left">Test2</td>
<td align="left">2013-04-29</td>
<td align="right">14.421</td>
<td align="right">12.497</td>
<td align="right">13.31387</td>
</tr>
<tr class="odd">
<td align="left">Test2</td>
<td align="left">2013-04-30</td>
<td align="right">15.091</td>
<td align="right">11.722</td>
<td align="right">13.41990</td>
</tr>
<tr class="even">
<td align="left">Test2</td>
<td align="left">2013-05-01</td>
<td align="right">15.569</td>
<td align="right">13.846</td>
<td align="right">14.63417</td>
</tr>
</tbody>
</table>
<p>Run StreamThermal functions with ‘sitedata’. The example below saves the output to a variable.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co">#~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~</span>
<span class="co"># 3. Run StreamThermal</span>
<span class="co"># Example using returned DF with StreamThermal</span>
<span class="co">#~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~</span>
<span class="co"># Library (load)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">require</a></span>(StreamThermal)
<span class="co">#~~~~~</span>
<span class="co"># StreamThermal</span>
ST.freq &lt;-<span class="st"> </span><span class="kw">T_frequency</span>(sitedata)
ST.mag  &lt;-<span class="st"> </span><span class="kw">T_magnitude</span>(sitedata)
ST.roc  &lt;-<span class="st"> </span><span class="kw">T_rateofchange</span>(sitedata)
ST.tim  &lt;-<span class="st"> </span><span class="kw">T_timing</span>(sitedata)
ST.var  &lt;-<span class="st"> </span><span class="kw">T_variability</span>(sitedata)</code></pre></div>
<p>The output of StreamThermal is 5 separate objects. It may be convenient to export that data to Excel with each object on a separate tab. Example code is below using the <code>XLConnect</code> library. This code is similar that provided in the Export.IHA example.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co">#~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~</span>
<span class="co"># Save Results to Excel (each group on its own worksheet)</span>
<span class="co">#~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span>(XLConnect)
<span class="co"># Descriptions</span>
<span class="co">#</span>
Desc.freq &lt;-<span class="st"> "Frequency metrics indicate numbers of days in months or seasons</span>
<span class="st">that key events exceed user-defined temperatures. "</span>
<span class="co">#</span>
Desc.mag &lt;-<span class="st"> "Magnitude metrics characterize monthly and seasonal averages and</span>
<span class="st">the maximum and minimum from daily temperatures as well as 3-, 7-, 14-, 21-,</span>
<span class="st">and 30-day moving averages for mean and maximum daily temperatures."</span>
<span class="co">#</span>
Desc.roc &lt;-<span class="st"> "Rate of change metrics include monthly and seasonal rate of</span>
<span class="st">change, which indicates the difference in magnitude of maximum and minimum</span>
<span class="st">temperatures divided by number of days between these events."</span>
<span class="co">#</span>
Desc.tim &lt;-<span class="st"> "Timing metrics indicate Julian days of key events including</span>
<span class="st">mean, maximum, and minimum temperatures; they also indicate Julian days of</span>
<span class="st">mean, maximum, and minimum values over moving windows of specified size."</span>
<span class="co">#</span>
Desc.var &lt;-<span class="st"> "Variability metrics summarize monthly and seasonal range in</span>
<span class="st">daily mean temperatures as well as monthly coefficient of variation of daily</span>
<span class="st">mean, maximum, and minimum temperatures. Variability metrics also include</span>
<span class="st">moving averages for daily ranges and moving variability in extreme</span>
<span class="st">temperatures, calculated from differences in average high and low</span>
<span class="st">temperatures over various time periods"</span>
<span class="co">#</span>
Group.Desc &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(Desc.freq, Desc.mag, Desc.roc, Desc.tim, Desc.var)
df.Groups &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/as.data.frame.html">as.data.frame</a></span>(<span class="kw"><a href="https://rdrr.io/r/base/cbind.html">cbind</a></span>(<span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"freq"</span>,<span class="st">"mag"</span>,<span class="st">"roc"</span>,<span class="st">"tim"</span>,<span class="st">"var"</span>),Group.Desc))
<span class="co">#</span>
SiteID &lt;-<span class="st"> </span>sitedata[<span class="dv">1</span>,<span class="dv">1</span>]
myDate &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/format.html">format</a></span>(<span class="kw"><a href="https://rdrr.io/r/base/Sys.time.html">Sys.Date</a></span>(),<span class="st">"%Y%m%d"</span>)
myTime &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/format.html">format</a></span>(<span class="kw"><a href="https://rdrr.io/r/base/Sys.time.html">Sys.time</a></span>(),<span class="st">"%H%M%S"</span>)
Notes.User &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/Sys.getenv.html">Sys.getenv</a></span>(<span class="st">"USERNAME"</span>)
<span class="co"># Notes section (add min/max dates)</span>
Notes.Names &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"Dataset (SiteID)"</span>, <span class="st">"Analysis.Date (YYYYMMDD)"</span>
                 , <span class="st">"Analysis.Time (HHMMSS)"</span>, <span class="st">"Analysis.User"</span>)
Notes.Data &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(SiteID, myDate, myTime, Notes.User)
df.Notes &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/as.data.frame.html">as.data.frame</a></span>(<span class="kw"><a href="https://rdrr.io/r/base/cbind.html">cbind</a></span>(Notes.Names, Notes.Data))
Notes.Summary &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/summary.html">summary</a></span>(sitedata)
<span class="co"># Open/Create file</span>
## New File Name
myFile.XLSX &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/paste.html">paste</a></span>(<span class="st">"StreamThermal"</span>, SiteID, myDate, myTime, <span class="st">"xlsx"</span>, <span class="dt">sep=</span><span class="st">"."</span>)
## Copy over template with Metric Definitions
<span class="kw"><a href="https://rdrr.io/r/base/files.html">file.copy</a></span>(<span class="kw"><a href="https://rdrr.io/r/base/file.path.html">file.path</a></span>(<span class="kw"><a href="https://rdrr.io/r/base/find.package.html">path.package</a></span>(<span class="st">"ContDataQC"</span>),<span class="st">"extdata"</span>,<span class="st">"StreamThermal_MetricList.xlsx"</span>)
          , myFile.XLSX)
## load workbook, create if not existing
wb &lt;-<span class="st"> </span><span class="kw">loadWorkbook</span>(myFile.XLSX, <span class="dt">create =</span> <span class="ot">TRUE</span>)
<span class="co"># create sheets</span>
<span class="kw">createSheet</span>(wb, <span class="dt">name =</span> <span class="st">"NOTES"</span>)
<span class="kw">createSheet</span>(wb, <span class="dt">name =</span> <span class="st">"freq"</span>)
<span class="kw">createSheet</span>(wb, <span class="dt">name =</span> <span class="st">"mag"</span>)
<span class="kw">createSheet</span>(wb, <span class="dt">name =</span> <span class="st">"roc"</span>)
<span class="kw">createSheet</span>(wb, <span class="dt">name =</span> <span class="st">"tim"</span>)
<span class="kw">createSheet</span>(wb, <span class="dt">name =</span> <span class="st">"var"</span>)
<span class="co"># write to worksheet</span>
<span class="kw">writeWorksheet</span>(wb, df.Notes, <span class="dt">sheet =</span> <span class="st">"NOTES"</span>, <span class="dt">startRow=</span><span class="dv">1</span>)
<span class="kw">writeWorksheet</span>(wb, df.Groups, <span class="dt">sheet=</span><span class="st">"NOTES"</span>, <span class="dt">startRow=</span><span class="dv">10</span>)
<span class="kw">writeWorksheet</span>(wb, Notes.Summary, <span class="dt">sheet =</span> <span class="st">"NOTES"</span>, <span class="dt">startRow=</span><span class="dv">20</span>)
<span class="kw">writeWorksheet</span>(wb, ST.freq, <span class="dt">sheet =</span> <span class="st">"freq"</span>)
<span class="kw">writeWorksheet</span>(wb, ST.mag, <span class="dt">sheet =</span> <span class="st">"mag"</span>)
<span class="kw">writeWorksheet</span>(wb, ST.roc, <span class="dt">sheet =</span> <span class="st">"roc"</span>)
<span class="kw">writeWorksheet</span>(wb, ST.tim, <span class="dt">sheet =</span> <span class="st">"tim"</span>)
<span class="kw">writeWorksheet</span>(wb, ST.var, <span class="dt">sheet =</span> <span class="st">"var"</span>)
<span class="co"># save workbook</span>
<span class="kw">saveWorkbook</span>(wb, myFile.XLSX)</code></pre></div>
</div>
<div id="comparison-cdfs" class="section level2">
<h2 class="hasAnchor">
<a href="#comparison-cdfs" class="anchor"></a>Comparison CDFs</h2>
<p>The function CompSite() allows the user to plot data from multiple sites on a single CDF.</p>
<p>The function takes as input a data frame with date and up to 8 columns of parameter data. Column names are Date and SiteIDs and values are daily means for some measurement.</p>
<p>More than 8 columns can be used but colors are recycled after 8 and the plot lines will be difficult to distinguish.</p>
<p>CDFs are generate for all data, year, season, and year/season and saved to a PDF. Winter + Year is such that December is included with the following year (e.g., Dec 2013, Jan 2014, Feb 2014 are 2014Winter).</p>
<p>Two plots per page are generated. The first plot is the proportion of values at a certain value.<br>
This plot is similar to a histogram.<br>
The second plot is a CDF of values. The line represents the proportion of values less than or equal to parameter values on the x-axis.</p>
<p>An example table to be used as input for the function is shown below. This table has data for five sites.</p>
<table class="table">
<thead><tr class="header">
<th align="left">Date</th>
<th align="right">Browns</th>
<th align="right">Hubbard</th>
<th align="right">Parkers</th>
<th align="right">Cold</th>
<th align="right">WBrSwift</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">2014-01-01</td>
<td align="right">0.5120208</td>
<td align="right">0.0690833</td>
<td align="right">0.2669167</td>
<td align="right">-0.0040000</td>
<td align="right">0.0094167</td>
</tr>
<tr class="even">
<td align="left">2014-01-02</td>
<td align="right">0.3215833</td>
<td align="right">0.0784167</td>
<td align="right">0.1561458</td>
<td align="right">-0.0040000</td>
<td align="right">-0.0040000</td>
</tr>
<tr class="odd">
<td align="left">2014-01-03</td>
<td align="right">0.0240000</td>
<td align="right">0.0790000</td>
<td align="right">0.1029167</td>
<td align="right">-0.0010833</td>
<td align="right">0.0158333</td>
</tr>
<tr class="even">
<td align="left">2014-01-04</td>
<td align="right">0.0240000</td>
<td align="right">0.0790000</td>
<td align="right">0.1385000</td>
<td align="right">-0.0016667</td>
<td align="right">-0.0005000</td>
</tr>
<tr class="odd">
<td align="left">2014-01-05</td>
<td align="right">0.2806250</td>
<td align="right">0.0790000</td>
<td align="right">0.2072083</td>
<td align="right">-0.0016667</td>
<td align="right">-0.0034167</td>
</tr>
<tr class="even">
<td align="left">2014-01-06</td>
<td align="right">0.5197708</td>
<td align="right">0.0790000</td>
<td align="right">0.2161458</td>
<td align="right">-0.0092500</td>
<td align="right">-0.0040000</td>
</tr>
</tbody>
</table>
<p>An example plot is shown below. The column names from the input table will appear in the legend of the plot. <img src="ContDataQC_Vignette_files/figure-html/CompSiteCDF_plot-1.png" width="672"><img src="ContDataQC_Vignette_files/figure-html/CompSiteCDF_plot-2.png" width="672"></p>
</div>
<div id="richards-baker-flashiness-index" class="section level2">
<h2 class="hasAnchor">
<a href="#richards-baker-flashiness-index" class="anchor"></a>Richards-Baker (Flashiness) Index</h2>
<p>Calculates the RBI from a vector of flow measurements. Inputs are are vector of flow measurements over some time period (e.g., water year). Output is a single value that represents the RBI.</p>
<p>The RBI is the sum of absolute differences between days divided by the total flow for the given time period.</p>
<p>Baker, D.B., R.P. Richards, T.T. Loftus, and J.W. Kramer. 2004. A New Flashiness Index: Characteristics and Applications to Midwestern Rivers and Streams. April 2004. Journal of the American Water Resources Association (JAWRA). Pages 503:522.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># Get Gage Data via the dataRetrieval package from USGS 01187300 2013</span>
data.gage &lt;-<span class="st"> </span>dataRetrieval<span class="op">::</span><span class="kw"><a href="https://rdrr.io/pkg/dataRetrieval/man/readNWISdv.html">readNWISdv</a></span>(<span class="st">"03238500"</span>, <span class="st">"00060"</span>, <span class="st">"1974-10-01"</span>, <span class="st">"1975-09-30"</span>)
<span class="kw"><a href="https://rdrr.io/r/utils/head.html">head</a></span>(data.gage)</code></pre></div>
<pre><code>##   agency_cd  site_no       Date X_00060_00003 X_00060_00003_cd
## 1      USGS 03238500 1974-10-01            38                A
## 2      USGS 03238500 1974-10-02            32                A
## 3      USGS 03238500 1974-10-03            26                A
## 4      USGS 03238500 1974-10-04            20                A
## 5      USGS 03238500 1974-10-05            23                A
## 6      USGS 03238500 1974-10-06            23                A</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># flow data</span>
data.Q &lt;-<span class="st"> </span>data.gage[,<span class="dv">4</span>]
<span class="co"># remove zeros</span>
data.Q[data.Q<span class="op">==</span><span class="dv">0</span>] &lt;-<span class="st"> </span><span class="ot">NA</span>
<span class="kw"><a href="../reference/RBIcalc.html">RBIcalc</a></span>(data.Q)</code></pre></div>
<pre><code>## [1] 0.9833356</code></pre>
<p>The calculated value from this function was QCed against data in the journal article.</p>
<p>Whiteoak Creek near Georgetown, Ohio (03238500) for the water year 1975 was download via the <code>dataRetrieval</code> package and used to generate the RBI. The value calculated by RBIcalc() matches the value in Figure 8 in the journal (0.98). The value was also verified using Excel.</p>
</div>
<div id="summary-stats-only" class="section level2">
<h2 class="hasAnchor">
<a href="#summary-stats-only" class="anchor"></a>Summary Stats Only</h2>
<p>The user sometimes will have data that is already QCed or that just needs summary stats. It is possible to run just the summary stats from <code>ContDataQC</code> but need to require certain fields.</p>
<ul>
<li>SiteID</li>
<li>Date</li>
<li>Time</li>
<li>Date.Time</li>
<li>Parameter names in ContDataQC format (config.R). Examples below:
<ul>
<li>Water.Temp.C</li>
<li>Discharge.ft3.s</li>
</ul>
</li>
<li>QC Flag fields for each parameter in the data (“Flag.” + Parameter Name). Examples below:
<ul>
<li>Flag.Water.Temp.C</li>
<li>Flag.Discharge.ft3.s</li>
</ul>
</li>
</ul>
<p>The example code below will download 2 years of discharge data from a the USGS gage 0118730, add the necessary fields, save the file, and run SummaryStats.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co">#~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~</span>
<span class="co"># Summary Stats from Other Data</span>
<span class="co">#~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~</span>
<span class="co"># Get Data, e.g., USGS gage data</span>
<span class="co"># Get Gage Data via the dataRetrieval package from USGS 01187300 2013 (~4 seconds)</span>
data.gage &lt;-<span class="st"> </span>dataRetrieval<span class="op">::</span><span class="kw"><a href="https://rdrr.io/pkg/dataRetrieval/man/readNWISuv.html">readNWISuv</a></span>(<span class="st">"01187300"</span>, <span class="st">"00060"</span>, <span class="st">"2013-01-01"</span>, <span class="st">"2014-12-31"</span>)
<span class="kw"><a href="https://rdrr.io/r/utils/head.html">head</a></span>(data.gage)
<span class="co"># Rename fields</span>
myNames &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"Agency"</span>, <span class="st">"SiteID"</span>, <span class="st">"Date.Time"</span>, <span class="st">"Discharge.ft3.s"</span>, <span class="st">"Code"</span>, <span class="st">"TZ"</span>)
<span class="kw"><a href="https://rdrr.io/r/base/names.html">names</a></span>(data.gage) &lt;-<span class="st"> </span>myNames
<span class="co"># Add Date and Time</span>
data.gage[,<span class="st">"Date"</span>] &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/as.Date.html">as.Date</a></span>(data.gage[,<span class="st">"Date.Time"</span>])
data.gage[,<span class="st">"Time"</span>] &lt;-<span class="st">  </span><span class="kw"><a href="https://rdrr.io/r/base/strptime.html">strftime</a></span>(data.gage[,<span class="st">"Date.Time"</span>], <span class="dt">format=</span><span class="st">"%H:%M:%S"</span>)
<span class="co"># Add "flag" fields that are added by QC function.</span>
Names.Flags &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span>(<span class="st">"Flag."</span>,<span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"Date.Time"</span>, <span class="st">"Discharge.ft3.s"</span>))
data.gage[,Names.Flags] &lt;-<span class="st"> "P"</span>
<span class="co"># Save File</span>
myFile &lt;-<span class="st"> "01187300_Gage_20130101_20141231.csv"</span>
<span class="kw"><a href="https://rdrr.io/r/utils/write.table.html">write.csv</a></span>(data.gage, myFile, <span class="dt">row.names=</span><span class="ot">FALSE</span>)
<span class="co"># Run Stats (File)</span>
myData.Operation &lt;-<span class="st"> "SummaryStats"</span>
myDir.import &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/getwd.html">getwd</a></span>()
myDir.export &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/getwd.html">getwd</a></span>()
<span class="kw"><a href="../reference/ContDataQC.html">ContDataQC</a></span>(myData.Operation
           , <span class="dt">fun.myDir.import=</span>myDir.import
           , <span class="dt">fun.myDir.export=</span>myDir.export
           , <span class="dt">fun.myFile=</span>myFile)</code></pre></div>
</div>
<div id="format-of-hoboware-output" class="section level2">
<h2 class="hasAnchor">
<a href="#format-of-hoboware-output" class="anchor"></a>Format of HOBOware Output</h2>
<p>Following the suggested RMN guidelines for creating HOBOware (PDF files included in help section of the package) will produce files with a known structure. HOBOware will not create files for use with R. The function formatHobo was created to bridge this gap.</p>
<p>Imports a HoboWare output (with minimal tweaks) from a folder, reformats it using defaults from the ContDataQC config file, and exports a CSV to another folder for use with ContDataQC.</p>
<p>Below are the default data directories assumed to exist in the working directory. These can be created with code as in the example. Using this function as an example, files will be imported from Data0_Original and exported to Data1_RAW.</p>
<ul>
<li><p>./Data0_Original/ = Unmodified data logger files.</p></li>
<li><p>./Data1_RAW/ = Data logger files modified for use with library. Modifications for extra rows and file and column names.</p></li>
<li><p>./Data2_QC/ = Repository for library output for QCed files.</p></li>
<li><p>./Data3_Aggregated/ = Repository for library output for aggregated (or split) files.</p></li>
<li><p>./Data4_Stats/ = Repository for library output for statistical summary files.</p></li>
</ul>
<p>File format should be “SiteID_SensorType_StartDate_EndData.csv”.</p>
<ul>
<li><p>SiteID = no spaces or underscores</p></li>
<li><p>SensorType = Air, Water, or AW (Air + Water in the same file)</p></li>
<li><p>Dates = YYYYMMDD (no delimiter)</p></li>
<li><p>Delimiter = underscore (as specified in the config file)</p></li>
</ul>
<p>No data frames are returned. A CSV file ready for use with the ContDataQC QC function will be generated in the specified output directory.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># Parameters</span>
Selection.Operation &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"GetGageData"</span>,<span class="st">"QCRaw"</span>, <span class="st">"Aggregate"</span>, <span class="st">"SummaryStats"</span>)
Selection.Type      &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"Air"</span>,<span class="st">"Water"</span>,<span class="st">"AW"</span>,<span class="st">"Gage"</span>,<span class="st">"AWG"</span>,<span class="st">"AG"</span>,<span class="st">"WG"</span>)
Selection.SUB       &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"Data0_Original"</span>, <span class="st">"Data1_RAW"</span>,<span class="st">"Data2_QC"</span>,<span class="st">"Data3_Aggregated"</span>,<span class="st">"Data4_Stats"</span>)
myDir.BASE          &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/getwd.html">getwd</a></span>()

<span class="co"># Create data directories</span>
myDir.create &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span>(<span class="st">"./"</span>,Selection.SUB[<span class="dv">1</span>])
  <span class="kw"><a href="https://rdrr.io/r/base/ifelse.html">ifelse</a></span>(<span class="kw"><a href="https://rdrr.io/r/base/files2.html">dir.exists</a></span>(myDir.create)<span class="op">==</span><span class="ot">FALSE</span>,<span class="kw"><a href="https://rdrr.io/r/base/files2.html">dir.create</a></span>(myDir.create),<span class="st">"Directory already exists"</span>)
myDir.create &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span>(<span class="st">"./"</span>,Selection.SUB[<span class="dv">2</span>])
  <span class="kw"><a href="https://rdrr.io/r/base/ifelse.html">ifelse</a></span>(<span class="kw"><a href="https://rdrr.io/r/base/files2.html">dir.exists</a></span>(myDir.create)<span class="op">==</span><span class="ot">FALSE</span>,<span class="kw"><a href="https://rdrr.io/r/base/files2.html">dir.create</a></span>(myDir.create),<span class="st">"Directory already exists"</span>)
myDir.create &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span>(<span class="st">"./"</span>,Selection.SUB[<span class="dv">3</span>])
  <span class="kw"><a href="https://rdrr.io/r/base/ifelse.html">ifelse</a></span>(<span class="kw"><a href="https://rdrr.io/r/base/files2.html">dir.exists</a></span>(myDir.create)<span class="op">==</span><span class="ot">FALSE</span>,<span class="kw"><a href="https://rdrr.io/r/base/files2.html">dir.create</a></span>(myDir.create),<span class="st">"Directory already exists"</span>)
myDir.create &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span>(<span class="st">"./"</span>,Selection.SUB[<span class="dv">4</span>])
  <span class="kw"><a href="https://rdrr.io/r/base/ifelse.html">ifelse</a></span>(<span class="kw"><a href="https://rdrr.io/r/base/files2.html">dir.exists</a></span>(myDir.create)<span class="op">==</span><span class="ot">FALSE</span>,<span class="kw"><a href="https://rdrr.io/r/base/files2.html">dir.create</a></span>(myDir.create),<span class="st">"Directory already exists"</span>)
myDir.create &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span>(<span class="st">"./"</span>,Selection.SUB[<span class="dv">5</span>])
  <span class="kw"><a href="https://rdrr.io/r/base/ifelse.html">ifelse</a></span>(<span class="kw"><a href="https://rdrr.io/r/base/files2.html">dir.exists</a></span>(myDir.create)<span class="op">==</span><span class="ot">FALSE</span>,<span class="kw"><a href="https://rdrr.io/r/base/files2.html">dir.create</a></span>(myDir.create),<span class="st">"Directory already exists"</span>)

<span class="co"># Save example data (assumes directory ./Data0_Original/ exists)</span>
fn_<span class="dv">1</span> &lt;-<span class="st"> "Charlies_Air_20170726_20170926.csv"</span>
fn_<span class="dv">2</span> &lt;-<span class="st"> "Charlies_AW_20170726_20170926.csv"</span>
fn_<span class="dv">3</span> &lt;-<span class="st"> "Charlies_Water_20170726_20170926.csv"</span>
fn_<span class="dv">4</span> &lt;-<span class="st"> "ECO66G12_AW_20160128_20160418.csv"</span>
<span class="kw"><a href="https://rdrr.io/r/base/lapply.html">lapply</a></span>(<span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(fn_<span class="dv">1</span>, fn_<span class="dv">2</span>, fn_<span class="dv">3</span>, fn_<span class="dv">4</span>), <span class="cf">function</span>(x)
       <span class="kw"><a href="https://rdrr.io/r/base/files.html">file.copy</a></span>(<span class="kw"><a href="https://rdrr.io/r/base/system.file.html">system.file</a></span>(<span class="st">"extdata"</span>, x, <span class="dt">package=</span><span class="st">"ContDataQC"</span>)
       , <span class="kw"><a href="https://rdrr.io/r/base/file.path.html">file.path</a></span>(myDir.BASE, Selection.SUB[<span class="dv">1</span>], x)))

<span class="co"># Function Inputs</span>
myFiles &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"Charlies_Air_20170726_20170926.csv"</span>
             , <span class="st">"Charlies_AW_20170726_20170926.csv"</span>
             , <span class="st">"Charlies_Water_20170726_20170926.csv"</span>)
myDir.import &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/file.path.html">file.path</a></span>(<span class="kw"><a href="https://rdrr.io/r/base/getwd.html">getwd</a></span>(), <span class="st">"Data0_Original"</span>)
myDir.export &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/file.path.html">file.path</a></span>(<span class="kw"><a href="https://rdrr.io/r/base/getwd.html">getwd</a></span>(), <span class="st">"Data1_RAW"</span>)

<span class="co"># Run Function (with default config)</span>
<span class="kw"><a href="../reference/formatHobo.html">formatHobo</a></span>(myFiles, myDir.import, myDir.export)

<span class="co">#~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~</span>
<span class="co"># QC the generated file with ContDataQC</span>
myData.Operation &lt;-<span class="st"> "QCRaw"</span> <span class="co">#Selection.Operation[2]</span>
myFile &lt;-<span class="st"> </span>myFiles
myDir.import &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/file.path.html">file.path</a></span>(<span class="st">"."</span>,<span class="st">"Data1_RAW"</span>)
myDir.export &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/file.path.html">file.path</a></span>(<span class="st">"."</span>,<span class="st">"Data2_QC"</span>)
myReport.format &lt;-<span class="st"> "html"</span>
<span class="kw"><a href="../reference/ContDataQC.html">ContDataQC</a></span>(myData.Operation, <span class="dt">fun.myDir.import=</span>myDir.import
          , <span class="dt">fun.myDir.export=</span>myDir.export, <span class="dt">fun.myFile=</span>myFile
          , <span class="dt">fun.myReport.format=</span>myReport.format)

<span class="co">#~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~</span>
<span class="co"># Example with unmodified dates</span>
myFiles &lt;-<span class="st"> "ECO66G12_AW_20160128_20160418.csv"</span>
myDir.import &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/file.path.html">file.path</a></span>(<span class="kw"><a href="https://rdrr.io/r/base/getwd.html">getwd</a></span>(), <span class="st">"Data0_Original"</span>)
myDir.export &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/file.path.html">file.path</a></span>(<span class="kw"><a href="https://rdrr.io/r/base/getwd.html">getwd</a></span>(), <span class="st">"Data1_RAW"</span>)
HoboDateFormat &lt;-<span class="st"> "MDY"</span>

<span class="co"># Run Function (with default config)</span>
<span class="kw"><a href="../reference/formatHobo.html">formatHobo</a></span>(myFiles, myDir.import, myDir.export, HoboDateFormat)</code></pre></div>
</div>
<div id="export-for-rlakeanalyzer" class="section level2">
<h2 class="hasAnchor">
<a href="#export-for-rlakeanalyzer" class="anchor"></a>Export for rLakeAnalyzer</h2>
<p>Continuous data from Lakes is similar to that used in streams.<br>
The only difference is the addition of depth to the data.<br>
There are R packages designed for the analysis of lake monitoring data. One such example is <code>rLakeAnalyzer</code>.</p>
<p>To aid users in QCing their continuous lake data an export function to <code>rLakeAnalyzer</code> was created in the <code>ContDataQC</code> package.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># Convert Data for use with rLakeAnalyzer</span>

<span class="co"># Data</span>
fn_CDQC &lt;-<span class="st"> "TestLake_Water_20180702_20181012.csv"</span>
df_CDQC &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/utils/read.table.html">read.csv</a></span>(<span class="kw"><a href="https://rdrr.io/r/base/file.path.html">file.path</a></span>(<span class="kw"><a href="https://rdrr.io/r/base/system.file.html">system.file</a></span>(<span class="dt">package =</span> <span class="st">"ContDataQC"</span>), <span class="st">"extdata"</span>, fn_CDQC))

<span class="co"># Convert Date.Time from factor to POSIXct (make it a date and time field in R)</span>
df_CDQC[, <span class="st">"Date.Time"</span>] &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/as.POSIXlt.html">as.POSIXct</a></span>(df_CDQC[, <span class="st">"Date.Time"</span>])

<span class="co"># Columns, date listed first</span>
col_depth &lt;-<span class="st"> "Depth"</span>
col_CDQC &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"Date.Time"</span>, <span class="st">"temp_F"</span>, <span class="st">"DO_conc"</span>)
col_rLA  &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"datetime"</span>, <span class="st">"wtr"</span>, <span class="st">"doobs"</span>)

<span class="co"># Output Options</span>
dir_export &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/getwd.html">getwd</a></span>()
fn_export &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span>(<span class="st">"rLA_"</span>, fn_CDQC)

<span class="co"># Run function</span>
df_rLA &lt;-<span class="st"> </span><span class="kw"><a href="../reference/Export.rLakeAnalyzer.html">Export.rLakeAnalyzer</a></span>(df_CDQC, col_depth, col_CDQC, col_rLA
                               , dir_export, fn_export)

<span class="co"># Visualize Input and Output</span>
knitr<span class="op">::</span><span class="kw"><a href="https://rdrr.io/pkg/knitr/man/kable.html">kable</a></span>(<span class="kw"><a href="https://rdrr.io/r/utils/head.html">head</a></span>(df_CDQC), <span class="dt">caption =</span> <span class="st">"Example ContDataQC to rLakeAnalyze format function input."</span>)</code></pre></div>
<table class="table">
<caption>Example ContDataQC to rLakeAnalyze format function input.</caption>
<thead><tr class="header">
<th align="left">SiteID</th>
<th align="left">Date.Time</th>
<th align="right">DO_conc</th>
<th align="right">temp_F</th>
<th align="right">Depth</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">TestLake</td>
<td align="left">2018-07-02 16:00:00</td>
<td align="right">2.24</td>
<td align="right">49.68</td>
<td align="right">9</td>
</tr>
<tr class="even">
<td align="left">TestLake</td>
<td align="left">2018-07-02 17:00:00</td>
<td align="right">2.54</td>
<td align="right">50.76</td>
<td align="right">9</td>
</tr>
<tr class="odd">
<td align="left">TestLake</td>
<td align="left">2018-07-02 18:00:00</td>
<td align="right">2.63</td>
<td align="right">50.65</td>
<td align="right">9</td>
</tr>
<tr class="even">
<td align="left">TestLake</td>
<td align="left">2018-07-02 19:00:00</td>
<td align="right">2.26</td>
<td align="right">49.89</td>
<td align="right">9</td>
</tr>
<tr class="odd">
<td align="left">TestLake</td>
<td align="left">2018-07-02 20:00:00</td>
<td align="right">2.48</td>
<td align="right">50.07</td>
<td align="right">9</td>
</tr>
<tr class="even">
<td align="left">TestLake</td>
<td align="left">2018-07-02 21:00:00</td>
<td align="right">2.63</td>
<td align="right">50.54</td>
<td align="right">9</td>
</tr>
</tbody>
</table>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">knitr<span class="op">::</span><span class="kw"><a href="https://rdrr.io/pkg/knitr/man/kable.html">kable</a></span>(<span class="kw"><a href="https://rdrr.io/r/utils/head.html">head</a></span>(df_rLA), <span class="dt">caption =</span> <span class="st">"Example ContDataQC to rLakeAnalyze format function output."</span>)</code></pre></div>
<table class="table">
<caption>Example ContDataQC to rLakeAnalyze format function output.</caption>
<thead><tr class="header">
<th align="left">datetime</th>
<th align="right">wtr_3</th>
<th align="right">wtr_6</th>
<th align="right">wtr_9</th>
<th align="right">doobs_3</th>
<th align="right">doobs_6</th>
<th align="right">doobs_9</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">2018-07-02 16:00:00</td>
<td align="right">71.10</td>
<td align="right">65.05</td>
<td align="right">49.68</td>
<td align="right">8.21</td>
<td align="right">5.44</td>
<td align="right">2.24</td>
</tr>
<tr class="even">
<td align="left">2018-07-02 17:00:00</td>
<td align="right">71.20</td>
<td align="right">63.10</td>
<td align="right">50.76</td>
<td align="right">8.31</td>
<td align="right">5.35</td>
<td align="right">2.54</td>
</tr>
<tr class="odd">
<td align="left">2018-07-02 18:00:00</td>
<td align="right">71.49</td>
<td align="right">58.03</td>
<td align="right">50.65</td>
<td align="right">8.37</td>
<td align="right">4.17</td>
<td align="right">2.63</td>
</tr>
<tr class="even">
<td align="left">2018-07-02 19:00:00</td>
<td align="right">71.67</td>
<td align="right">57.60</td>
<td align="right">49.89</td>
<td align="right">8.40</td>
<td align="right">4.35</td>
<td align="right">2.26</td>
</tr>
<tr class="odd">
<td align="left">2018-07-02 20:00:00</td>
<td align="right">71.56</td>
<td align="right">55.69</td>
<td align="right">50.07</td>
<td align="right">8.26</td>
<td align="right">3.94</td>
<td align="right">2.48</td>
</tr>
<tr class="even">
<td align="left">2018-07-02 21:00:00</td>
<td align="right">71.38</td>
<td align="right">57.27</td>
<td align="right">50.54</td>
<td align="right">8.40</td>
<td align="right">4.35</td>
<td align="right">2.63</td>
</tr>
</tbody>
</table>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co">#~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~</span>
<span class="co"># Plot original data in ggplot</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span>(ggplot2)

<span class="co"># Plot, Create</span>
p &lt;-<span class="st"> </span><span class="kw">ggplot</span>(df_CDQC, <span class="kw">aes</span>(<span class="dt">x=</span>Date.Time, <span class="dt">y=</span>temp_F)) <span class="op">+</span>
<span class="st">       </span><span class="kw">geom_point</span>(<span class="kw">aes</span>(<span class="dt">color=</span>Depth)) <span class="op">+</span>
<span class="st">       </span><span class="kw">scale_color_continuous</span>(<span class="dt">trans=</span><span class="st">"reverse"</span>) <span class="op">+</span>
<span class="st">       </span><span class="kw">scale_x_datetime</span>(<span class="dt">date_labels =</span> <span class="st">"%Y-%m"</span>)

<span class="co"># Plot, Show</span>
<span class="kw"><a href="https://rdrr.io/r/base/print.html">print</a></span>(p)</code></pre></div>
<pre><code>## Warning: Removed 3 rows containing missing values (geom_point).</code></pre>
<p><img src="ContDataQC_Vignette_files/figure-html/rLA_Example-1.png" width="700"></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co">#~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~</span>
<span class="co"># use rLakeAnalyzer</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span>(rLakeAnalyzer)
<span class="co">#library(knitr)</span>

<span class="co"># Filter Data for only temperature</span>
col_wtr &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/colnames.html">colnames</a></span>(df_rLA)[<span class="kw"><a href="https://rdrr.io/r/base/grep.html">grepl</a></span>(<span class="st">"wtr_"</span>, <span class="kw"><a href="https://rdrr.io/r/base/colnames.html">colnames</a></span>(df_rLA))]
df_rLA_wtr &lt;-<span class="st"> </span>df_rLA[, <span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"datetime"</span>, col_wtr)]

<span class="co"># Create bathymetry data frame</span>
df_rLA_bth &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span>(<span class="dt">depths=</span><span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="dv">3</span>,<span class="dv">6</span>,<span class="dv">9</span>), <span class="dt">areas=</span><span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="dv">300</span>,<span class="dv">200</span>,<span class="dv">100</span>))

<span class="co"># Visualize Input Data</span>
knitr<span class="op">::</span><span class="kw"><a href="https://rdrr.io/pkg/knitr/man/kable.html">kable</a></span>(<span class="kw"><a href="https://rdrr.io/r/utils/head.html">head</a></span>(df_rLA_wtr), <span class="dt">caption =</span> <span class="st">"rLakeAnalyzer; Example water temperature data"</span>)</code></pre></div>
<table class="table">
<caption>rLakeAnalyzer; Example water temperature data</caption>
<thead><tr class="header">
<th align="left">datetime</th>
<th align="right">wtr_3</th>
<th align="right">wtr_6</th>
<th align="right">wtr_9</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">2018-07-02 16:00:00</td>
<td align="right">71.10</td>
<td align="right">65.05</td>
<td align="right">49.68</td>
</tr>
<tr class="even">
<td align="left">2018-07-02 17:00:00</td>
<td align="right">71.20</td>
<td align="right">63.10</td>
<td align="right">50.76</td>
</tr>
<tr class="odd">
<td align="left">2018-07-02 18:00:00</td>
<td align="right">71.49</td>
<td align="right">58.03</td>
<td align="right">50.65</td>
</tr>
<tr class="even">
<td align="left">2018-07-02 19:00:00</td>
<td align="right">71.67</td>
<td align="right">57.60</td>
<td align="right">49.89</td>
</tr>
<tr class="odd">
<td align="left">2018-07-02 20:00:00</td>
<td align="right">71.56</td>
<td align="right">55.69</td>
<td align="right">50.07</td>
</tr>
<tr class="even">
<td align="left">2018-07-02 21:00:00</td>
<td align="right">71.38</td>
<td align="right">57.27</td>
<td align="right">50.54</td>
</tr>
</tbody>
</table>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">knitr<span class="op">::</span><span class="kw"><a href="https://rdrr.io/pkg/knitr/man/kable.html">kable</a></span>(<span class="kw"><a href="https://rdrr.io/r/utils/head.html">head</a></span>(df_rLA_bth), <span class="dt">caption =</span> <span class="st">"rLakeAnalyzer; Example depth and area data"</span>)</code></pre></div>
<table class="table">
<caption>rLakeAnalyzer; Example depth and area data</caption>
<thead><tr class="header">
<th align="right">depths</th>
<th align="right">areas</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="right">3</td>
<td align="right">300</td>
</tr>
<tr class="even">
<td align="right">6</td>
<td align="right">200</td>
</tr>
<tr class="odd">
<td align="right">9</td>
<td align="right">100</td>
</tr>
</tbody>
</table>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># Generate Heat Map</span>
<span class="kw">wtr.heat.map</span>(df_rLA_wtr)</code></pre></div>
<p><img src="ContDataQC_Vignette_files/figure-html/rLA_Example-2.png" width="700"></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># Generate Schmidt Plot</span>
<span class="kw">schmidt.plot</span>(df_rLA_wtr, df_rLA_bth)</code></pre></div>
<p><img src="ContDataQC_Vignette_files/figure-html/rLA_Example-3.png" width="700"></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># Generate Schmidt Stability Values</span>
df_rLA_Schmidt &lt;-<span class="st"> </span><span class="kw">ts.schmidt.stability</span>(df_rLA_wtr, df_rLA_bth)

<span class="co"># Visualize Output Data</span>
knitr<span class="op">::</span><span class="kw"><a href="https://rdrr.io/pkg/knitr/man/kable.html">kable</a></span>(<span class="kw"><a href="https://rdrr.io/r/utils/head.html">head</a></span>(df_rLA_Schmidt), <span class="dt">caption =</span> <span class="st">"rLakeAnalyzer; Example Schmidt Stability output."</span>)</code></pre></div>
<table class="table">
<caption>rLakeAnalyzer; Example Schmidt Stability output.</caption>
<thead><tr class="header">
<th align="left">datetime</th>
<th align="right">schmidt.stability</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">2018-07-02 16:00:00</td>
<td align="right">197.8109</td>
</tr>
<tr class="even">
<td align="left">2018-07-02 17:00:00</td>
<td align="right">196.6225</td>
</tr>
<tr class="odd">
<td align="left">2018-07-02 18:00:00</td>
<td align="right">214.8701</td>
</tr>
<tr class="even">
<td align="left">2018-07-02 19:00:00</td>
<td align="right">223.8640</td>
</tr>
<tr class="odd">
<td align="left">2018-07-02 20:00:00</td>
<td align="right">226.1239</td>
</tr>
<tr class="even">
<td align="left">2018-07-02 21:00:00</td>
<td align="right">216.3078</td>
</tr>
</tbody>
</table>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co">#~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~</span>
<span class="co"># Plot original data in ggplot</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span>(ggplot2)

<span class="co"># Plot, Create</span>
p &lt;-<span class="st"> </span><span class="kw">ggplot</span>(df_CDQC, <span class="kw">aes</span>(<span class="dt">x=</span>Date.Time, <span class="dt">y=</span>temp_F)) <span class="op">+</span>
<span class="st">       </span><span class="kw">geom_point</span>(<span class="kw">aes</span>(<span class="dt">color=</span>Depth)) <span class="op">+</span>
<span class="st">       </span><span class="kw">scale_color_continuous</span>(<span class="dt">trans=</span><span class="st">"reverse"</span>) <span class="op">+</span>
<span class="st">       </span><span class="kw">scale_x_datetime</span>(<span class="dt">date_labels =</span> <span class="st">"%Y-%m"</span>)

<span class="co"># Plot, Show</span>
p</code></pre></div>
<pre><code>## Warning: Removed 3 rows containing missing values (geom_point).</code></pre>
<p><img src="ContDataQC_Vignette_files/figure-html/rLA_Example-4.png" width="700"></p>
</div>
</div>
<div id="data-from-other-sources" class="section level1">
<h1 class="hasAnchor">
<a href="#data-from-other-sources" class="anchor"></a>Data from Other Sources</h1>
<p>It is possible to use data from other sources. The focus of the package has been user’s with no data system. Some users already have a system such as Aquarius. Below is an example script for obtaining data from such a system. The script was contributed by Mark Hoger of PA DEP. This script is saved in the extdata folder as Aquarius_Data_Aquisition_PADEP.r.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co">#~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~</span>
<span class="co">#</span>
<span class="co"># This script accesses data using AQUARIUS Time-Series 3.x's Publish API.</span>
<span class="co"># </span>
<span class="co"># </span>
<span class="co"># It depends on the RCurl library; to download and install</span>
<span class="co"># RCurl into your R environment, use this command:</span>
<span class="co">#</span>
<span class="co">#      install.packages('RCurl')</span>
<span class="co">#</span>
<span class="co">#</span>
<span class="co"># Initial command examples were provided by Aquatic Informatics </span>
<span class="co"># technical staff. These examples were then adapted by Mark Hoger at </span>
<span class="co"># Pennsylvania Department of Environmental Protection.</span>
<span class="co">#</span>
<span class="co"># Mark Hoger </span>
<span class="co"># mhoger@pa.gov</span>
<span class="co">#</span>
<span class="co">#~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~</span>

<span class="co">#~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~</span>
<span class="co">#</span>
<span class="co"># Initialize Connection to Database</span>
<span class="co">#</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span>(RCurl)

co&lt;-<span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>()
<span class="co"># Enter server and AQUARIUS username and password between the ''</span>
server&lt;-<span class="st">''</span>
username&lt;-<span class="st">''</span>
pw&lt;-<span class="st">''</span>
service&lt;-<span class="kw"><a href="https://rdrr.io/r/base/paste.html">paste</a></span>(<span class="st">'http://'</span>, server, <span class="st">'/aquarius/Publish/AquariusPublishRestService.svc'</span>, <span class="dt">sep=</span><span class="st">''</span>)
getauthtoken&lt;-<span class="kw"><a href="https://rdrr.io/r/base/paste.html">paste</a></span>(service, <span class="st">'/GetAuthToken?user='</span>, username, <span class="st">'&amp;encPwd='</span>, pw, <span class="dt">sep=</span><span class="st">''</span>)
token&lt;-<span class="kw">getURL</span>(<span class="dt">.opts=</span>co,getauthtoken)
co&lt;-<span class="kw">curlOptions</span>(<span class="dt">.opts=</span>co,<span class="dt">httpheader=</span><span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="dt">AQAuthToken=</span>token))
<span class="co">#</span>
<span class="co"># The above commands should result in a token that will be used to access</span>
<span class="co"># data stored in the database.</span>
<span class="co">#</span>
<span class="co">#~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~</span>

<span class="co">#~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~</span>
<span class="co">#</span>
<span class="co"># Data Acquisition</span>
<span class="co">#</span>
<span class="co"># Locations and datasets are selected prior to extracting data. This</span>
<span class="co"># approach reduces the time required to extract data since often only a </span>
<span class="co"># subset of the data is needed. </span>
<span class="co">#</span>
<span class="co"># Steps</span>
<span class="co"># 1. Get a list of locations from database.</span>
<span class="co"># 2. Choose locations.</span>
<span class="co"># 3. Get a list of datasets at the chosen locations.</span>
<span class="co"># 4. Choose datasets (e.g. pH and DO datasets).</span>
<span class="co"># 5. Extract data from datasets chosen. Can limit extraction by date/time</span>
<span class="co">#    during this process.</span>
<span class="co">#</span>
<span class="co">#~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~</span>
<span class="co"># Step 1. Get a list of locations. ####</span>
<span class="co">#</span>
getlocations&lt;-<span class="kw"><a href="https://rdrr.io/r/base/paste.html">paste</a></span>(service, <span class="st">'/GetLocations'</span>,<span class="dt">sep=</span><span class="st">''</span>)
locs.all=<span class="kw"><a href="https://rdrr.io/r/utils/read.table.html">read.csv</a></span>(<span class="kw"><a href="https://rdrr.io/r/base/textconnections.html">textConnection</a></span>(<span class="kw">getURL</span>(<span class="dt">.opts=</span>co, getlocations)))
<span class="co">#</span>
<span class="co">#~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~</span>
<span class="co"># Step 2. Choose locations. ####</span>
<span class="co">#</span>
<span class="co"># These steps will depend on the structure of how locations are stored in</span>
<span class="co"># the database you are pulling from. In PADEP's setup, the folders are</span>
<span class="co"># structured by Internal/External data, basin, HUC, then stream name. This</span>
<span class="co"># folder structure is contained in the LOCATIONPATH field and serves as an</span>
<span class="co"># excellent way of grabbing sites from within a watershed. </span>
<span class="co">#</span>
<span class="co"># All subsetting from the original list of locations, locs.all, is stored </span>
<span class="co"># in a dataframe called locs.subset. This dataframe name is used in the </span>
<span class="co"># following steps so it is recommended that you rewrite over, locs. subset</span>
<span class="co"># if multiple steps are done instead of renaming each subset. </span>
<span class="co"># </span>
<span class="co"># Example subsetting of locations. grepl looks for character strings.</span>
<span class="co">#</span>
<span class="co"># To grab all internal data we can use LOCATIONPATH</span>
locs.subset&lt;-locs.all[<span class="kw"><a href="https://rdrr.io/r/base/grep.html">grepl</a></span>(<span class="st">'Internal Data'</span>,locs.all<span class="op">$</span>LOCATIONPATH),]
<span class="co">#</span>
<span class="co"># To search multiple key strings use | as the "or" function: </span>
<span class="co"># 'Swatara|Goose' will return locations with either 'Swatara' or 'Goose' </span>
<span class="co"># in LOCATIONNAME</span>
locs.subset&lt;-locs.subset[<span class="kw"><a href="https://rdrr.io/r/base/grep.html">grepl</a></span>(<span class="st">'Swatara|Goose'</span>,locs.subset<span class="op">$</span>LOCATIONNAME),]
<span class="co">#</span>
<span class="co">#~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~</span>
<span class="co"># Step 3. Get a list of datasets. ####</span>
<span class="co">#</span>
<span class="co"># A loop function is used to pull a list of all datasets at each location</span>
<span class="co"># in locs.subset.</span>
n.sites&lt;-<span class="kw"><a href="https://rdrr.io/r/base/length.html">length</a></span>(locs.subset<span class="op">$</span>IDENTIFIER) <span class="co"># Count locations for the loop</span>
datalist =<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/list.html">list</a></span>() <span class="co"># Create temporary holder of data</span>
<span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="op">:</span>n.sites){
  getdatasets&lt;-<span class="kw"><a href="https://rdrr.io/r/base/paste.html">paste</a></span>(service,<span class="st">'/GetDataSetsList?locId='</span>,locs.subset<span class="op">$</span>IDENTIFIER[i],<span class="dt">sep=</span><span class="st">''</span>)
  datalist[[i]]=<span class="kw"><a href="https://rdrr.io/r/utils/read.table.html">read.csv</a></span>(<span class="kw"><a href="https://rdrr.io/r/base/textconnections.html">textConnection</a></span>(<span class="kw">getURL</span>(<span class="dt">.opts=</span>co,getdatasets)))
}
datasets =<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/do.call.html">do.call</a></span>(rbind, datalist) <span class="co"># Combine data gathered in loop into </span>
<span class="co">#                                     a dataframe</span>
<span class="co">#</span>
<span class="co"># Make sure no errors were thrown during the loop. If a problem occurred</span>
<span class="co"># it could be with the naming or formatting in AQUARIUS. For example, the</span>
<span class="co"># parameter name (Label field of a dataset in Location Manager) cannot </span>
<span class="co"># include any spaces. Also, time series that have been created but do not</span>
<span class="co"># contain any data will cause problems. A good way to find the issue is</span>
<span class="co"># to see how many elements were created in the loop.</span>
<span class="co">#</span>
<span class="co">#~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~</span>
<span class="co"># Step 4. Choose datasets. ####</span>
<span class="co">#</span>
<span class="co"># Like with the locations, you now need to select only that datasets you</span>
<span class="co"># want. Again, it is recommended to maintain the dataframe name 'datasets'</span>
<span class="co"># to avoid the need to adjust code in future steps.</span>
<span class="co">#</span>
<span class="co"># To remove Field Visit series from the list of datasets use !grepl to </span>
<span class="co"># select all datasets except those with the given character string. </span>
datasets &lt;-<span class="st"> </span>datasets[<span class="op">!</span><span class="kw"><a href="https://rdrr.io/r/base/grep.html">grepl</a></span>(<span class="st">"Field Visits"</span>, datasets<span class="op">$</span>DataId),]
<span class="co">#</span>
<span class="co"># To select datasets based on parameter type, use parameter identifiers.</span>
<span class="co"># The most common identifiers used by PADEP are below. Parameter  </span>
<span class="co"># identifiers can be found in AQUARIUS manager under the parameter tab, </span>
<span class="co"># Parameter ID column.</span>
<span class="co">#       TW = Water temperature</span>
<span class="co">#       SpCond = Specific Conductance</span>
<span class="co">#       PH = pH</span>
<span class="co">#       WO = Dissolved oxygen - concentration</span>
<span class="co">#       WX = Dissolved oxygen - % sat</span>
<span class="co">#       WT = Turbidity</span>
<span class="co">#       HG = Stage</span>
<span class="co">#       QR = Discharge</span>
<span class="co">#       PA = Atmospheric pressure</span>
<span class="co">#       44500 = Calculated-derived series</span>
<span class="co">#</span>
<span class="co"># I typically don't use grepl to subset parameters just in case we ever  </span>
<span class="co"># have parameters that contain the same character strings. Instead use </span>
<span class="co"># the following subsetting command.</span>
<span class="co">#</span>
<span class="co"># To grab only water temperature datasets.</span>
datasets &lt;-<span class="st"> </span>datasets[datasets<span class="op">$</span>Parameter<span class="op">==</span><span class="st">'TW'</span>,]
<span class="co"># To grab multiple parameter types, use | as the "or" function. For both </span>
<span class="co"># pH and DO concentration datasets: </span>
datasets &lt;-<span class="st"> </span>datasets[datasets<span class="op">$</span>Parameter<span class="op">==</span><span class="st">'PH'</span> <span class="op">|</span><span class="st"> </span>datasets<span class="op">$</span>Parameter<span class="op">==</span><span class="st">'WO'</span>,]
<span class="co">#</span>
<span class="co">#~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~</span>
<span class="co"># Step 5. Extract data. ####</span>
<span class="co">#</span>
<span class="co"># The datasets dataframe does not contain much location information. To </span>
<span class="co"># better tie location data to the data about to be extracted, I use merge </span>
<span class="co"># to add fields from locs.subset to the datasets dataframe.</span>
datasets&lt;-<span class="kw"><a href="https://rdrr.io/r/base/merge.html">merge</a></span>(datasets,locs.subset,<span class="dt">all=</span><span class="ot">FALSE</span>,<span class="dt">by.x=</span><span class="st">'LocationId'</span>,<span class="dt">by.y=</span><span class="st">'IDENTIFIER'</span>)
<span class="co">#</span>
<span class="co"># Now we finally grab the actual data from the list of datasets in the </span>
<span class="co"># dataframe 'datasets'. Again, a loop function is used.</span>
n.datasets &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/length.html">length</a></span>(datasets<span class="op">$</span>DataId) <span class="co"># Count datasets for the loop</span>
datalist2 =<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/list.html">list</a></span>() <span class="co"># Create temporary holder of data</span>
<span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="op">:</span>n.datasets){
         <span class="co"># Date range can be selected here. Blank will return all data</span>
         <span class="co"># from the datasets. Format is '2016-10-17T00:00:00.000-05:00'</span>
  start_dt=<span class="st">''</span>
  end_dt=<span class="st">''</span>
  gettimeseriesdata&lt;-<span class="kw"><a href="https://rdrr.io/r/base/paste.html">paste</a></span>(service, <span class="st">'/GetTimeSeriesData'</span>, <span class="st">'?dataId='</span>, datasets<span class="op">$</span>DataId[i], <span class="st">'&amp;queryFrom='</span>, start_dt, <span class="st">'&amp;queryTo='</span>, end_dt, <span class="dt">sep=</span><span class="st">''</span>)
  datalist2[[i]]=<span class="kw"><a href="https://rdrr.io/r/utils/read.table.html">read.csv</a></span>(<span class="kw"><a href="https://rdrr.io/r/base/textconnections.html">textConnection</a></span>(<span class="kw">getURL</span>(<span class="dt">.opts=</span>co, gettimeseriesdata)), <span class="dt">skip=</span><span class="dv">4</span>)
  datalist2[[i]]<span class="op">$</span>Time=<span class="kw"><a href="https://rdrr.io/r/base/strptime.html">strptime</a></span>(<span class="kw"><a href="https://rdrr.io/r/base/substr.html">substr</a></span>(datalist2[[i]]<span class="op">$</span>Time,<span class="dv">0</span>,<span class="dv">19</span>),<span class="st">"%FT%T"</span>)        
         <span class="co"># Add some additional identifying columns. Merge with locs.subset</span>
         <span class="co"># must have been done.</span>
  datalist2[[i]]<span class="op">$</span>SiteID&lt;-<span class="kw"><a href="https://rdrr.io/r/base/rep.html">rep</a></span>(datasets<span class="op">$</span>LocationId[i],<span class="kw"><a href="https://rdrr.io/r/base/dim.html">dim</a></span>(datalist2[[i]])[<span class="dv">1</span>])
  datalist2[[i]]<span class="op">$</span>Site&lt;-<span class="kw"><a href="https://rdrr.io/r/base/rep.html">rep</a></span>(datasets<span class="op">$</span>LOCATIONNAME[i],<span class="kw"><a href="https://rdrr.io/r/base/dim.html">dim</a></span>(datalist2[[i]])[<span class="dv">1</span>])
  datalist2[[i]]<span class="op">$</span>Parameter&lt;-<span class="kw"><a href="https://rdrr.io/r/base/rep.html">rep</a></span>(datasets<span class="op">$</span>Parameter[i],<span class="kw"><a href="https://rdrr.io/r/base/dim.html">dim</a></span>(datalist2[[i]])[<span class="dv">1</span>])
  datalist2[[i]]<span class="op">$</span>Units&lt;-<span class="kw"><a href="https://rdrr.io/r/base/rep.html">rep</a></span>(datasets<span class="op">$</span>Unit[i],<span class="kw"><a href="https://rdrr.io/r/base/dim.html">dim</a></span>(datalist2[[i]])[<span class="dv">1</span>])
  datalist2[[i]]<span class="op">$</span>ParameterName&lt;-<span class="kw"><a href="https://rdrr.io/r/base/rep.html">rep</a></span>(datasets<span class="op">$</span>DataId[i],<span class="kw"><a href="https://rdrr.io/r/base/dim.html">dim</a></span>(datalist2[[i]])[<span class="dv">1</span>])
}
dat =<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/do.call.html">do.call</a></span>(rbind, datalist2) <span class="co"># Combine data gathered in loop into </span>
<span class="co">#                                 a dataframe</span>
<span class="co">#</span>
<span class="co"># See comments at end of Step 3 if you are getting errors during loop.</span>
<span class="co">#</span>
<span class="co">#~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~</span></code></pre></div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="sidebar">

        <div id="tocnav">
      <h2 class="hasAnchor">
<a href="#tocnav" class="anchor"></a>Contents</h2>
      <ul class="nav nav-pills nav-stacked">
<li><a href="#introduction">Introduction</a></li>
      <li><a href="#installation">Installation</a></li>
      <li><a href="#contents">Contents</a></li>
      <li>
<a href="#preparing-raw-data">Preparing Raw Data</a><ul class="nav nav-pills nav-stacked">
<li><a href="#file-names">File Names</a></li>
      <li><a href="#file-structure">File Structure</a></li>
      </ul>
</li>
      <li>
<a href="#the-contdataqc-function">The ContDataQC Function</a><ul class="nav nav-pills nav-stacked">
<li><a href="#operations">Operations</a></li>
      <li><a href="#single-file-versions-of-contdataqc-operatations">Single File Versions of ContDataQC Operatations</a></li>
      <li><a href="#other-features">Other Features</a></li>
      <li><a href="#configuration-file">Configuration File</a></li>
      <li><a href="#period-stats">Period Stats</a></li>
      <li><a href="#export-for-iha">Export for IHA</a></li>
      <li><a href="#rarify-taxa-data">Rarify Taxa Data</a></li>
      <li><a href="#visualization-of-daily-means">Visualization of Daily Means</a></li>
      <li><a href="#output-for-streamthermal">Output for StreamThermal</a></li>
      <li><a href="#comparison-cdfs">Comparison CDFs</a></li>
      <li><a href="#richards-baker-flashiness-index">Richards-Baker (Flashiness) Index</a></li>
      <li><a href="#summary-stats-only">Summary Stats Only</a></li>
      <li><a href="#format-of-hoboware-output">Format of HOBOware Output</a></li>
      <li><a href="#export-for-rlakeanalyzer">Export for rLakeAnalyzer</a></li>
      </ul>
</li>
      <li><a href="#data-from-other-sources">Data from Other Sources</a></li>
      </ul>
</div>
      </div>

</div>



      <footer><div class="copyright">
  <p>Developed by Erik W. Leppo.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.4.1.</p>
</div>

      </footer>
</div>

  


  </body>
</html>
