,sep="_")
,myFile.Export.ext)
# save
write.csv(df.summary.subset, file.path(fun.myDir.export, myFile.Export.full),quote=FALSE,row.names=FALSE)
}##FOR.j.END
#
}##FOR.i.END
# 7. Generate markdown summary file with plots ####
# extra info for report (20180118)
myDate.File.Min <- min(df.load$Date)
myDate.Diff.FileMin.Benchmark <- as.Date(fun.myDate) - as.Date(myDate.File.Min)
# Error Check, Report Format
if(fun.myReport.format==""){
fun.myReport.format <- ContData.env$myReport.Format
}
fun.myReport.format <- tolower(fun.myReport.format)
# 20180212
# Error Check, Report Directory
if(fun.myReport.Dir==""){
fun.myReport.Dir <- ContData.env$myReport.Dir
}
#myReport.Name <- paste0("Report_PeriodStats","_",fun.myReport.format)
myReport.Name <- "Report_PeriodStats"
myPkg <- "ContDataQC"
if(boo_DEBUG==TRUE){
strFile.RMD <- file.path(getwd(),"inst","rmd",paste0(myReport.Name,".rmd")) # for testing
} else {
#strFile.RMD <- system.file(paste0("rmd/",myReport.Name,".rmd"),package=myPkg)
# use provided dir for template
strFile.RMD <- file.path(fun.myReport.Dir, paste0(myReport.Name, ".rmd"))
}
#
#
strFile.out.ext <- paste0(".",fun.myReport.format) #".docx" # ".html"
strFile.out <- paste0(paste(myFile.Export.base,"PeriodStats",fun.myDate,paste(fun.myParam.Name,collapse="_"),myDate,myTime,sep="_"), strFile.out.ext)
strFile.RMD.format <- paste0(ifelse(fun.myReport.format=="docx","word",fun.myReport.format),"_document")
#
knitr::opts_chunk$set(results='asis', echo=FALSE, warning=FALSE)
# needed for trouble shooting
#myConfig <- file.path(system.file(package="ContDataQC"), "extdata", "config.ORIG.R")
#source(myConfig)
# Report Info
myReportDate <- format(Sys.Date(),fun.myDate.Format)
# myReportDate <- format(Sys.Date(),fd01)
cat(paste("**Report Date:** ",myReportDate,"\n\n",sep=""))
myUser <- Sys.getenv("USERNAME")
cat(paste("**Generated By:** ",myUser,"\n\n",sep=""))
cat("**Benchmark Date:** ",fun.myDate,collapse="\n\n",sep="")
cat("**Period (N, Units):** ",paste(fun.myPeriod.N[1:numPeriods]
,fun.myPeriod.Units[1:numPeriods], collapse=", ", sep="")
, collapse="\n\n", sep="")
cat(paste("**Period Start Date:** ",paste(as.Date(myDate.Start[1:numPeriods]),collapse=", "),sep=""),collapse="\n\n")
cat("**Minimum Date in File:** ", myDate.File.Min, collapse="\n\n", sep="")
cat("**Difference (Benchmark-Minimum Date):** ", myDate.Diff.FileMin.Benchmark, collapse="\n\n", sep="")
cat("**Parameter(s):** ",paste(fun.myParam.Name,collapse=", ",sep=""),collapse="\n\n",sep="")
cat("**Threshold:** ",fun.myThreshold,collapse="\n\n",sep="")
cat("**QC Flag Failures Exclude:** ",ContData.env$myStats.Fails.Exclude,collapse="\n\n",sep="")
cat("**Filename, Input:** ",fun.myFile,"\n\n",sep="")
#cat("**Filename, Output:** ",paste0(myFile.Export.part,myFile.Export.ext),sep="")
fun.myParam.Name
m <- fun.myParam.Name[1]
m.num <- match(m, fun.myParam.Name)
# print header 2
cat("\n\n")
cat("## ",fun.myParam.Name[m.num],sep="")
cat("\n\n")
flush.console()
#
# select df based on iteration
if(m.num==1){##IF.m.num.START
df.summary.plot <- df.summary.plot.1
} else if (m.num==2){
df.summary.plot <- df.summary.plot.2
}##IF.m.num.END
m
for (n in 1:numPeriods){##FOR.n.START
# subset
df.plot <- df.summary.plot[df.summary.plot[,myDate.Name]>=as.Date(myDate.Start[n]) & df.summary.plot[,myDate.Name]<=as.Date(myDate.End), ]
# create file name
plot(df.plot[,1:2]
, main=paste0(fun.myDate," \n(",fun.myPeriod.N[n],fun.myPeriod.Units[n],")")
)
# Add line
if(!is.na(fun.myThreshold)){
abline(h=fun.myThreshold)
}
}
str(df.summary.plot)
x_name <- names(df.summary)[1]
y_name <- names(df.summary)[2]
ggplot(df.summary.plot) +
ggplot2::geom_point(aes_q(x=as.name(x_name), y=as.name(y_name)))
ggplot2::ggplot(df.summary.plot) +
ggplot2::geom_point(ggplot2::aes_q(x=as.name(x_name), y=as.name(y_name)))
names(df.summary)[1]
names(df.summary)[2]
m.num
# select df based on iteration
if(m.num==1){##IF.m.num.START
df.summary.plot <- df.summary.plot.1
} else if (m.num==2){
df.summary.plot <- df.summary.plot.2
}##IF.m.num.END
#~~~~~~~~~~~~~~~~~~
# ggplot alternative
#~~~~~~~~~~~~~~~~~~
x_name <- names(df.summary)[1]
y_name <- names(df.summary)[2]
ggplot2::ggplot(df.summary.plot) +
ggplot2::geom_point(ggplot2::aes_q(x=as.name(x_name), y=as.name(y_name)))
str(df.summary.plot)
p_ps <- ggplot2::ggplot(df.summary.plot) +
ggplot2::geom_point(ggplot2::aes_q(x=as.name(x_name), y=as.name(y_name)))
print(p_ps)
x_name <- names(df.summary.plot)[1]
y_name <- names(df.summary.plot)[2]
p_ps <- ggplot2::ggplot(df.summary.plot) +
ggplot2::geom_point(ggplot2::aes_q(x=as.name(x_name), y=as.name(y_name)))
print(p_ps)
p_ps
p_ps <- ggplot2::ggplot(df.summary.plot) +
ggplot2::geom_point(ggplot2::aes_q(x=as.name(x_name), y=as.name(y_name))) +
ggplot2::labs(title=mySiteID) +
ggplot2::theme(plot.title=ggplot2::element_text(hjust=0.5)
, plot.subtitle=ggplot2::element_text(hjust=0.5))
print(p_ps)
str_title    <- fun.myDate
str_subtitle <- paste0(fun.myPeriod.N[n], fun.myPeriod.Units[n])
p_ps <- ggplot2::ggplot(df.summary.plot) +
ggplot2::geom_point(ggplot2::aes_q(x=as.name(x_name), y=as.name(y_name))) +
ggplot2::labs(title=str_title, subtitle=str_subtitle) +
ggplot2::theme(plot.title=ggplot2::element_text(hjust=0.5)
, plot.subtitle=ggplot2::element_text(hjust=0.5))
print(p_ps)
str_title    <- fun.myDate
str_subtitle <- paste0("(", fun.myPeriod.N[n], fun.myPeriod.Units[n], ")")
p_ps <- ggplot2::ggplot(df.summary.plot) +
ggplot2::geom_point(ggplot2::aes_q(x=as.name(x_name), y=as.name(y_name))) +
ggplot2::labs(title=str_title, subtitle=str_subtitle) +
ggplot2::theme(plot.title=ggplot2::element_text(hjust=0.5)
, plot.subtitle=ggplot2::element_text(hjust=0.5))
print(p_ps)
p_ps + geom_hline(ggplot2::aes_string(yintercept=fun.myThreshold))
p_ps + ggplot2::geom_hline(ggplot2::aes_string(yintercept=fun.myThreshold))
param.len
p <- 1
myParam.Name <- c("Water.Temp.C", "Sensor.Depth.ft")
PeriodStats(myDate
, myDate.Format
, myPeriod.N
, myPeriod.Units
, myFile
, myDir.import
, myDir.export
, myParam.Name
, myDateTime.Name
, myDateTime.Format
, myThreshold
, myConfig.Fail.Include
, myReport.format)
?PeriodStats
PeriodStats(myDate
, myDate.Format
, myPeriod.N
, myPeriod.Units
, myFile
, myDir.import
, myDir.export
, myParam.Name
, myDateTime.Name
, myDateTime.Format
, myThreshold
, myConfig)
# function inputs
myDate <- "2013-09-30"
myDate.Format <- "%Y-%m-%d"
myPeriod.N <- c(30, 60, 90, 120, 1)
myPeriod.Units <- c("d", "d", "d", "d", "y")
myFile <- "DATA_period_test2_Aw_20130101_20141231.csv"
myDir.import <- getwd()
myDir.export <- getwd()
myParam.Name <-  c("Water.Temp.C", "Sensor.Depth.ft")
myDateTime.Name <- "Date.Time"
myDateTime.Format <- "%Y-%m-%d %H:%M:%S"
myThreshold <- 20
myConfig <- ""
myReport.format <- "html"
# Custom Config
myConfig.Fail.Include  <- "config.ExcludeFailsFalse.R"
myParam.Name <- c("Water.Temp.C", "Sensor.Depth.ft")
PeriodStats(myDate
, myDate.Format
, myPeriod.N
, myPeriod.Units
, myFile
, myDir.import
, myDir.export
, myParam.Name
, myDateTime.Name
, myDateTime.Format
, myThreshold
, myConfig.Fail.Include
, myReport.format)
# NEWS
# Render then Copy NEWS so picked up in help
rmarkdown::render("NEWS.rmd", "all")
file.copy("NEWS.md", "NEWS", overwrite = TRUE)
file.remove("NEWS.html")
file.remove("NEWS.md")
#
# Library Name
myLibrary <- "ContDataQC"
# Load Library
library(devtools)
#~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
# Create Package
# create(myLibrary)
#~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
#
#~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
# Document, Install, and Reload Library
## Generate Documentation
setwd(paste0("./",myLibrary))
devtools::document()
## Install New Package (locally)
setwd("..") # return to root directory first
devtools::install(myLibrary)
## Reload library
library(myLibrary,character.only = TRUE)
# change wd back to package
setwd(paste0("./",myLibrary))
pkg <- "ContDataQC"
library(pkg, character.only = TRUE)
help(package=(pkg))
#
?PeriodStats
# Load File to use for PeriodStats
myDir <- getwd()
myFile <- "DATA_period_test2_Aw_20130101_20141231.csv"
df.x <- read.csv(file.path(myDir, myFile))
# function inputs
myDate <- "2013-09-30"
myDate.Format <- "%Y-%m-%d"
myPeriod.N <- c(30, 60, 90, 120, 1)
myPeriod.Units <- c("d", "d", "d", "d", "y")
myFile <- "DATA_period_test2_Aw_20130101_20141231.csv"
myDir.import <- getwd()
myDir.export <- getwd()
myParam.Name <- "Water.Temp.C"
myDateTime.Name <- "Date.Time"
myDateTime.Format <- "%Y-%m-%d %H:%M:%S"
myThreshold <- 20
myConfig <- ""
myReport.format <- "docx"
# Custom Config
myConfig.Fail.Include  <- "config.ExcludeFailsFalse.R"
# Run Function
## Example 1. default report format (html)
PeriodStats(myDate
, myDate.Format
, myPeriod.N
, myPeriod.Units
, myFile
, myDir.import
, myDir.export
, myParam.Name
, myDateTime.Name
, myDateTime.Format
, myThreshold
, myConfig)
# NEWS
# Render then Copy NEWS so picked up in help
rmarkdown::render("NEWS.rmd", "all")
file.copy("NEWS.md", "NEWS", overwrite = TRUE)
file.remove("NEWS.html")
file.remove("NEWS.md")
#
# Library Name
myLibrary <- "ContDataQC"
# Load Library
library(devtools)
#~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
# Create Package
# create(myLibrary)
#~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
#
#~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
# Document, Install, and Reload Library
## Generate Documentation
setwd(paste0("./",myLibrary))
devtools::document()
## Install New Package (locally)
setwd("..") # return to root directory first
devtools::install(myLibrary)
## Reload library
library(myLibrary,character.only = TRUE)
# change wd back to package
setwd(paste0("./",myLibrary))
pkg <- "ContDataQC"
library(pkg, character.only = TRUE)
help(package=(pkg))
# Load File to use for PeriodStats
myDir <- getwd()
myFile <- "DATA_period_test2_Aw_20130101_20141231.csv"
df.x <- read.csv(file.path(myDir, myFile))
# function inputs
myDate <- "2013-09-30"
myDate.Format <- "%Y-%m-%d"
myPeriod.N <- c(30, 60, 90, 120, 1)
myPeriod.Units <- c("d", "d", "d", "d", "y")
myFile <- "DATA_period_test2_Aw_20130101_20141231.csv"
myDir.import <- getwd()
myDir.export <- getwd()
myParam.Name <- "Water.Temp.C"
myDateTime.Name <- "Date.Time"
myDateTime.Format <- "%Y-%m-%d %H:%M:%S"
myThreshold <- 20
myConfig <- ""
myReport.format <- "docx"
# Custom Config
myConfig.Fail.Include  <- "config.ExcludeFailsFalse.R"
# Run Function
## Example 1. default report format (html)
PeriodStats(myDate
, myDate.Format
, myPeriod.N
, myPeriod.Units
, myFile
, myDir.import
, myDir.export
, myParam.Name
, myDateTime.Name
, myDateTime.Format
, myThreshold
, myConfig)
# NEWS
# Render then Copy NEWS so picked up in help
rmarkdown::render("NEWS.rmd", "all")
file.copy("NEWS.md", "NEWS", overwrite = TRUE)
file.remove("NEWS.html")
file.remove("NEWS.md")
#
# Library Name
myLibrary <- "ContDataQC"
# Load Library
library(devtools)
#~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
# Create Package
# create(myLibrary)
#~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
#
#~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
# Document, Install, and Reload Library
## Generate Documentation
setwd(paste0("./",myLibrary))
devtools::document()
## Install New Package (locally)
setwd("..") # return to root directory first
devtools::install(myLibrary)
## Reload library
library(myLibrary,character.only = TRUE)
# change wd back to package
setwd(paste0("./",myLibrary))
# Restart R within RStudio:  Ctrl + Shift + F10
pkg <- "ContDataQC"
library(pkg, character.only = TRUE)
help(package=(pkg))
library(ContDataQC)
?ContDataQC
Config.Out()
fun.myConfig=""
#
boo_DEBUG <- FALSE
if(boo_DEBUG==TRUE){##IF~boo_DEBUG~START
fun.myConfig        <- ""
fun.myDir.export    <- getwd()
fun.myReport.format <- "html"
fun.myReport.Dir    <- ""
}##IF~boo_DEBUG~START
# config file load, 20170517
if (fun.myConfig!="") {##IF.fun.myConfig.START
config.load(fun.myConfig)
}##IF.fun.myConfig.START
#
library(MBSStools)
?metric.values
# NEWS
# Render then Copy NEWS so picked up in help
rmarkdown::render("NEWS.rmd", "all")
file.copy("NEWS.md", "NEWS", overwrite = TRUE)
file.remove("NEWS.html")
file.remove("NEWS.md")
#
# Library Name
myLibrary <- "ContDataQC"
# Load Library
library(devtools)
#~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
# Create Package
# create(myLibrary)
#~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
#
#~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
# Document, Install, and Reload Library
## Generate Documentation
setwd(paste0("./",myLibrary))
devtools::document()
## Install New Package (locally)
setwd("..") # return to root directory first
devtools::install(myLibrary)
## Reload library
library(myLibrary,character.only = TRUE)
# change wd back to package
setwd(paste0("./",myLibrary))
pkg <- "ContDataQC"
library(pkg, character.only = TRUE)
help(package=(pkg))
Config.Out()
?basename
# NEWS
# Render then Copy NEWS so picked up in help
rmarkdown::render("NEWS.rmd", "all")
file.copy("NEWS.md", "NEWS", overwrite = TRUE)
file.remove("NEWS.html")
file.remove("NEWS.md")
#
# Library Name
myLibrary <- "ContDataQC"
# Load Library
library(devtools)
#~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
# Create Package
# create(myLibrary)
#~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
#
#~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
# Document, Install, and Reload Library
## Generate Documentation
setwd(paste0("./",myLibrary))
devtools::document()
## Install New Package (locally)
setwd("..") # return to root directory first
devtools::install(myLibrary)
## Reload library
library(myLibrary,character.only = TRUE)
# change wd back to package
setwd(paste0("./",myLibrary))
pkg <- "ContDataQC"
library(pkg, character.only = TRUE)
help(package=(pkg))
Config.Out()
library(MBSStools)
?metric.scores
# NEWS
# Render then Copy NEWS so picked up in help
rmarkdown::render("NEWS.rmd", "all")
file.copy("NEWS.md", "NEWS", overwrite = TRUE)
file.remove("NEWS.html")
file.remove("NEWS.md")
#
# Library Name
myLibrary <- "ContDataQC"
# Load Library
library(devtools)
#~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
# Create Package
# create(myLibrary)
#~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
#
#~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
# Document, Install, and Reload Library
## Generate Documentation
setwd(paste0("./",myLibrary))
devtools::document()
## Install New Package (locally)
setwd("..") # return to root directory first
devtools::install(myLibrary)
## Reload library
library(myLibrary,character.only = TRUE)
# change wd back to package
setwd(paste0("./",myLibrary))
# NEWS
# Render then Copy NEWS so picked up in help
rmarkdown::render("NEWS.rmd", "all")
file.copy("NEWS.md", "NEWS", overwrite = TRUE)
file.remove("NEWS.html")
file.remove("NEWS.md")
#
# Library Name
myLibrary <- "ContDataQC"
# Load Library
library(devtools)
#~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
# Create Package
# create(myLibrary)
#~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
#
#~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
# Document, Install, and Reload Library
## Generate Documentation
setwd(paste0("./",myLibrary))
devtools::document()
## Install New Package (locally)
setwd("..") # return to root directory first
devtools::install(myLibrary)
## Reload library
library(myLibrary,character.only = TRUE)
# change wd back to package
setwd(paste0("./",myLibrary))
pkg <- "ContDataQC"
library(pkg, character.only = TRUE)
help(package=(pkg))
